/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var e,t={5163:(e,t,n)=>{"use strict";n.d(t,{ZT:()=>i,pi:()=>o,gn:()=>s,mG:()=>a,Jh:()=>u});var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)};function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var o=function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)};function s(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}function a(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))}function u(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}Object.create,Object.create},2618:(e,t,n)=>{"use strict";var r=n(8010),i=n.n(r),o=n(1920),s=n.n(o),a=n(133),u=n.n(a),c=n(6496),h=n.n(c),l=n(9257);function f(){this.preventDefaults=!1,this.stopPropagation=!1,this.allowContextMenu=!1,this.disabled=!1}function d(e){for(var t in e)e[t]=0}function p(e){window.addEventListener("keydown",v.bind(null,e,!0),!1),window.addEventListener("keyup",v.bind(null,e,!1),!1);var t={passive:!0};window.PointerEvent?(e.element.addEventListener("pointerdown",m.bind(null,e,!0),t),window.document.addEventListener("pointerup",m.bind(null,e,!1),t),e.element.addEventListener("pointermove",g.bind(null,e),t)):(e.element.addEventListener("mousedown",m.bind(null,e,!0),t),window.document.addEventListener("mouseup",m.bind(null,e,!1),t),e.element.addEventListener("mousemove",g.bind(null,e),t)),e.element.addEventListener("wheel",y.bind(null,e),t),e.element.addEventListener("contextmenu",_.bind(null,e),!1),window.addEventListener("blur",b.bind(null,e),!1)}function v(e,t,n){k(n.code,t,e,n)}function m(e,t,n){if("pointerId"in n)if(t){if(null!==e._touches.currID)return;e._touches.currID=n.pointerId}else{if(e._touches.currID!==n.pointerId)return;e._touches.currID=null}return k("Mouse"+("button"in n?n.button+1:1),t,e,n),!1}function g(e,t){if(!("pointerId"in t)||null===e._touches.currID||e._touches.currID===t.pointerId){var n=t.movementX||t.mozMovementX||0,r=t.movementY||t.mozMovementY||0;e.pointerState.dx+=n,e.pointerState.dy+=r}}function y(e,t){var n=1;switch(t.deltaMode){case 0:n=1;break;case 1:n=12;break;case 2:n=e.element.clientHeight||window.innerHeight}e.pointerState.scrollx+=(t.deltaX||0)*n,e.pointerState.scrolly+=(t.deltaY||0)*n,e.pointerState.scrollz+=(t.deltaZ||0)*n}function _(e,t){if(!e.allowContextMenu)return t.preventDefault(),!1}function b(e){for(var t in e._keyStates)e._keyStates[t]&&(/^Mouse\d/.test(t)||k(t,!1,e,{code:t,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function k(e,t,n,r){var i=n._keyBindmap[e];i&&(w(n._keyStates[e],t)&&(n._keyStates[e]=t,i.forEach((e=>{(!n.filterEvents||n.filterEvents(r,e))&&function(e,t,n,r){var i=t?n.pressCount:n.releaseCount;i[e]=(i[e]||0)+1;var o=n._bindPressCount[e]||0;if((o+=t?1:-1)<0&&(o=0),n._bindPressCount[e]=o,w(n.state[e],o)){n.state[e]=o>0;var s=t?n.down:n.up;n.disabled||s.emit(e,r)}}(e,t,n,r)}))),"button"in r||(n.preventDefaults&&!r.defaultPrevented&&r.preventDefault(),n.stopPropagation&&r.stopPropagation()))}function w(e,t){return e?!t:t}var x={preventDefaults:!1,stopPropagation:!1,allowContextMenu:!1},M={forward:["KeyW","ArrowUp"],backward:["KeyS","ArrowDown"],left:["KeyA","ArrowLeft"],right:["KeyD","ArrowRight"],fire:"Mouse1","mid-fire":["Mouse2","KeyQ"],"alt-fire":["Mouse3","KeyE"],jump:"Space"};class C extends class{constructor(e,t){this.version="0.7.0";var n=Object.assign({},new f,t||{});this.element=e||document,this.preventDefaults=!!n.preventDefaults,this.stopPropagation=!!n.stopPropagation,this.allowContextMenu=!!n.allowContextMenu,this.disabled=!!n.disabled,this.filterEvents=(e,t)=>!0,this.down=new l.EventEmitter,this.up=new l.EventEmitter,this.state={},this.pointerState={dx:0,dy:0,scrollx:0,scrolly:0,scrollz:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?p(this):document.addEventListener("DOMContentLoaded",(e=>{p(this)}),{once:!0})}bind(e,...t){t.forEach((t=>{var n=this._keyBindmap[t]||[];n.includes(e)||(n.push(e),this._keyBindmap[t]=n)})),this.state[e]=!!this.state[e],this.pressCount[e]=this.pressCount[e]||0,this.releaseCount[e]=this.releaseCount[e]||0}unbind(e){for(var t in this._keyBindmap){var n=this._keyBindmap[t],r=n.indexOf(e);r>-1&&n.splice(r,1)}}getBindings(){var e={};for(var t in this._keyBindmap)this._keyBindmap[t].forEach((n=>{e[n]=e[n]||[],e[n].push(t)}));return e}tick(){d(this.pointerState),d(this.pressCount),d(this.releaseCount)}}{constructor(e,t,n){super(n,t=Object.assign({},x,t));var r=t.bindings||M;for(var i in r){var o=Array.isArray(r[i])?r[i]:[r[i]];this.bind(i,...o)}}}class P{constructor(e=null,t=10,n=100){this.stickyPointerLock=!1,this.stickyFullscreen=!1,this.tickRate=30,this.maxRenderRate=0,this.pointerLock=!1,this.fullscreen=!1,this.onTick=function(e){},this.onRender=function(){},this.onInit=function(){},this.onResize=function(){},this.onPointerLockChanged=function(e){},this.onFullscreenChanged=function(e){},this.onPointerLockerror=function(e){},T((()=>{!function(e,t,n){e._nowObject=performance||Date,e._skipFramesAfter=n,e._renderAccum=0;var r=e._nowObject.now();e._lastTick=r,e._lastRender=r,e._frameCB=D.bind(null,e),requestAnimationFrame(e._frameCB),t>0&&(e._intervalCB=I.bind(null,e),e._interval=setInterval(e._intervalCB,t))}(this,t,n),function(e,t){if(t){var n=!1,r=!1,i=r=>{if(t.requestPointerLock&&!!r!==n)if(r){var i=t.requestPointerLock();i.catch&&i.catch((t=>{e.onPointerLockerror&&e.onPointerLockerror(t)}))}else document.exitPointerLock()},o=e=>{t.requestFullscreen&&!!e!==r&&(e?t.requestFullscreen():document.exitFullscreen())};document.addEventListener("pointerlockchange",(r=>{n=document.pointerLockElement===t,e.onPointerLockChanged(n)})),document.addEventListener("fullscreenchange",(n=>{r=document.fullscreenElement===t,e.onFullscreenChanged(r)})),Object.defineProperty(e,"pointerLock",{get:()=>n,set:i}),Object.defineProperty(e,"fullscreen",{get:()=>r,set:o}),t.addEventListener("click",(t=>{e.stickyPointerLock&&!n&&i(!0),e.stickyFullscreen&&!r&&o(!0)}));var s=()=>e.onResize();window.ResizeObserver?new ResizeObserver(s).observe(t):window.addEventListener("resize",s)}}(this,e),this.onInit()}))}}function I(e){for(var t=e._nowObject.now(),n=t+e._skipFramesAfter,r=1e3/e.tickRate;e._lastTick+r<t;)if(e.onTick(r),e._lastTick+=r,(t=e._nowObject.now())>n)return void(e._lastTick=t)}function D(e){requestAnimationFrame(e._frameCB),I(e);var t=e._nowObject.now(),n=t-e._lastRender;if(e._lastRender=t,e.maxRenderRate>0){e._renderAccum+=n;var r=1e3/e.maxRenderRate;if(e._renderAccum<r)return;e._renderAccum=Math.min(e._renderAccum-r,r)}var i=1e3/e.tickRate,o=(t-e._lastTick)/i;e.onRender(n,o,i)}var T=e=>{if("loading"===document.readyState){var t=()=>{document.removeEventListener("readystatechange",t),e()};document.addEventListener("readystatechange",t)}else setTimeout(e,1)};class L extends a.EventEmitter{constructor(e,t){var n,r,i;super(),t=t||{},this.noa=e,this.element=t.domElement||((n=document.createElement("div")).tabIndex=1,n.style.position="fixed",n.style.left="0px",n.style.right="0px",n.style.top="0px",n.style.bottom="0px",n.style.height="100%",n.style.overflow="hidden",document.body.appendChild(n),document.body.style.overflow="hidden",document.body.style.height="100%",n.id="noa-container",n),this.canvas=(r=this.element,(i=r.querySelector("canvas"))||((i=document.createElement("canvas")).style.position="absolute",i.style.left="0px",i.style.top="0px",i.style.height="100%",i.style.width="100%",i.id="noa-canvas",r.insertBefore(i,r.firstChild)),i),this.supportsPointerLock=!1,this.pointerInGame=!1,this.isFocused=!!document.hasFocus(),this.hasPointerLock=!1,this._shell=new P(this.element,10),this._shell.tickRate=t.tickRate,this._shell.maxRenderRate=t.maxRenderRate,this._shell.stickyPointerLock=t.stickyPointerLock,this._shell.stickyFullscreen=t.stickyFullscreen,this._shell.onTick=e.tick.bind(e),this._shell.onRender=e.render.bind(e),this._shell.onPointerLockChanged=e=>{this.hasPointerLock=e,this.emit(e?"gainedPointerLock":"lostPointerLock"),e&&(this.pointerInGame=!0)},this._shell.onInit=()=>{this._shell.onResize=e.rendering.resize.bind(e.rendering),function(e){if("pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document){e.supportsPointerLock=!0;var t=function(n){e.supportsPointerLock=!1,document.removeEventListener(n.type,t)};document.addEventListener("touchmove",t)}}(this),this.element.addEventListener("mouseenter",(()=>{this.pointerInGame=!0})),this.element.addEventListener("mouseleave",(()=>{this.pointerInGame=!1})),window.addEventListener("focus",(()=>{this.isFocused=!0})),window.addEventListener("blur",(()=>{this.isFocused=!1}));var t=()=>{this.pointerInGame=!0,this.isFocused=!0,this.element.removeEventListener("mousedown",t)};this.element.addEventListener("mousedown",t),this.emit("DOMready"),this._shell.onInit=null}}appendTo(e){this.element.appendChild(e)}setPointerLock(e=!1){this._shell.pointerLock=!!e}}var A=n(2034),E=n.n(A),S=n(7504),j=n.n(S),R={inverseX:!1,inverseY:!1,sensitivityX:10,sensitivityY:10,initialZoom:0,zoomSpeed:.2},O=[i().create(),i().create(),i().create()],F=i().create();class B{constructor(e,t){t=Object.assign({},R,t),this.noa=e,this.sensitivityX=+t.sensitivityX,this.sensitivityY=+t.sensitivityY,this.inverseX=!!t.inverseX,this.inverseY=!!t.inverseY,this.heading=0,this.pitch=0,this.cameraTarget=this.noa.ents.createEntity(["position"]);var n=.9*e.ents.getPositionData(e.playerEntity).height;e.ents.addComponent(this.cameraTarget,"followsEntity",{entity:e.playerEntity,offset:[0,n,0]}),this.zoomDistance=t.initialZoom,this.zoomSpeed=t.zoomSpeed,this.currentZoom=t.initialZoom,this._currentZoom=this.currentZoom,Object.defineProperty(this,"currentZoom",{get:()=>this._currentZoom}),this._dirVector=i().fromValues(0,0,1)}_localGetTargetPosition(){var e=this.noa.ents.getPositionData(this.cameraTarget),t=O[0];return i().copy(t,e._renderPosition)}_localGetPosition(){var e=this._localGetTargetPosition();return 0===this._currentZoom?e:i().scaleAndAdd(e,e,this._dirVector,-this._currentZoom)}getTargetPosition(){var e=this._localGetTargetPosition(),t=O[1];return this.noa.localToGlobal(e,t)}getPosition(){var e=this._localGetPosition(),t=O[2];return this.noa.localToGlobal(e,t)}getDirection(){return this._dirVector}applyInputsToCamera(){var e=this.noa.inputs.pointerState;!function(e){var t=e.dx,n=e.dy,r=Math.abs(t)>400&&Math.abs(t/z)>4,i=Math.abs(n)>400&&Math.abs(n/U)>4;r||i?(e.dx=z,e.dy=U,z=(z+t)/2,U=(U+n)/2):(z=t||1,U=n||1)}(e);var t=.0066*Math.PI/180,n=e.dy*this.sensitivityY*t,r=e.dx*this.sensitivityX*t;this.inverseY&&(n=-n),this.inverseX&&(r=-r);var o=2*Math.PI;this.heading+=r<0?r+o:r,this.heading>o&&(this.heading-=o);var s=Math.PI/2-.001;this.pitch=Math.max(-s,Math.min(s,this.pitch+n)),i().set(this._dirVector,0,0,1);var a=this._dirVector,u=F;i().rotateX(a,a,u,this.pitch),i().rotateY(a,a,u,this.heading)}updateBeforeEntityRenderSystems(){this._currentZoom+=(this.zoomDistance-this._currentZoom)*this.zoomSpeed}updateAfterEntityRenderSystems(){var e=function(e){e._sweepBox||(e._sweepBox=new(E())([0,0,0],[.2,.2,.2]),e._sweepGetVoxel=e.noa.world.getBlockSolidity.bind(e.noa.world),e._sweepVec=i().create(),e._sweepHit=()=>!0);var t=i().copy(e._sweepVec,e._localGetTargetPosition());i().add(t,t,e.noa.worldOriginOffset);for(var n=0;n<3;n++)t[n]-=.1;e._sweepBox.setPosition(t);var r=Math.max(e.zoomDistance,e.currentZoom)+.1;return i().scale(e._sweepVec,e.getDirection(),-r),j()(e._sweepGetVoxel,e._sweepBox,e._sweepVec,e._sweepHit,!0)}(this);this._currentZoom>e&&(this._currentZoom=e)}}var z=0,U=0,N=n(1628),V=n.n(N);class q{constructor(){this.position=null,this.width=.8,this.height=.8,this._localPosition=null,this._renderPosition=null,this._extents=null}}function H(e){return{name:"position",order:60,state:new q,onAdd:function(t,n){var r=[0,0,0];n.position&&i().copy(r,n.position),n.position=r,n._localPosition=i().create(),n._renderPosition=i().create(),n._extents=new Float32Array(6),e.globalToLocal(n.position,null,n._localPosition),i().copy(n._renderPosition,n._localPosition),K(n)},onRemove:null,system:function(t,n){for(var r=e.worldOriginOffset,o=0;o<n.length;o++){var s=n[o];i().add(s.position,s._localPosition,r),K(s)}}}}function K(e){var t=e.width/2,n=e._localPosition,r=e._extents;r[0]=n[0]-t,r[1]=n[1],r[2]=n[2]-t,r[3]=n[0]+t,r[4]=n[1]+e.height,r[5]=n[2]+t}class G{constructor(){this.body=null}}function W(e){return{name:"physics",order:40,state:new G,onAdd:function(t,n){n.body=e.physics.addBody(),Y(n,e.ents.getPositionData(n.__id))},onRemove:function(t,n){if(e.ents.hasPosition(n.__id)){var r=e.ents.getPositionData(n.__id);X(n,r),$(n,r,0,!1)}e.physics.removeBody(n.body)},system:function(t,n){for(var r=0;r<n.length;r++){var i=n[r];X(i,e.ents.getPositionData(i.__id))}},renderSystem:function(t,n){for(var r=e.positionInCurrentTick,i=1e3/e.container._shell.tickRate,o=(r*(i*=e.timeScale)-i)/1e3,s=0;s<n.length;s++){var a=n[s],u=a.__id;$(a,e.ents.getPositionData(u),o,e.ents.cameraSmoothed(u))}}}}var Z=i().create();function Y(e,t){var n=e.body.aabb,r=t._extents;i().copy(n.base,r),i().set(n.vec,t.width,t.height,t.width),i().add(n.max,n.base,n.vec)}function X(e,t){var n=e.body.aabb.base,r=t.width/2;i().set(t._localPosition,n[0]+r,n[1],n[2]+r)}function $(e,t,n,r){var o=e.body.velocity;i().scaleAndAdd(Z,t._localPosition,o,n),r&&i().lerp(Z,t._renderPosition,Z,.3),i().copy(t._renderPosition,Z)}var Q=n(9535);function J(e){var t=[];return{name:"collideEntities",order:70,state:{cylinder:!1,collideBits:1,collideMask:1,callback:null},onAdd:null,onRemove:null,system:function(r,i){for(var o=e.ents,s=0;s<i.length;s++){var a=i[s].__id,u=o.getPositionData(a);t[s]=u._extents}t.length=i.length,Q(t,(function(r,o){var s=i[r],a=i[o];s&&a&&function(e,t,r,i){return e.cylinder?t.cylinder?function(e,t){var n=(e[3]-e[0])/2,r=(t[3]-t[0])/2,i=e[0]+n-(t[0]+r),o=e[2]+n-(t[2]+r),s=n+r;return i*i+o*o<=s*s}(r,i):n(r,i):!t.cylinder||n(i,r)}(s,a,t[r],t[o])&&function(e,t,n){var r=t.__id,i=n.__id;t.collideMask&n.collideBits&&t.callback&&t.callback(i),n.collideMask&t.collideBits&&n.callback&&n.callback(r),e.ents.onPairwiseEntityCollision(r,i)}(e,s,a)}))}};function n(e,t){var n=(e[3]-e[0])/2,i=e[0]+n,o=e[2]+n,s=r(i,t[0],t[3])-i,a=r(o,t[2],t[5])-o;return s*s+a*a<=n*n}function r(e,t,n){return e<t?t:e>n?n:e}}function ee(e){return{name:"collideTerrain",order:0,state:{callback:null},onAdd:function(t,n){var r=e.entities;r.hasPhysics(t)&&(r.getPhysics(t).body.onCollide=function(n){var r=e.ents.getCollideTerrain(t).callback;r&&r(n,t)})},onRemove:function(t,n){var r=e.entities;r.hasPhysics(t)&&(r.getPhysics(t).body.onCollide=null)}}}function te(e){return{name:"fadeOnZoom",order:99,state:{cutoff:1.5,_showing:null},onAdd:null,onRemove:null,system:function(t,n){for(var r=e.camera.currentZoom,i=e.entities,o=0;o<n.length;o++)ne(n[o],r,i)}}}function ne(e,t,n){if(n.hasMesh(e.__id)){var r=t>e.cutoff;e._showing!==r&&(n.getMeshData(e.__id).mesh.visibility=r,e._showing=r)}}function re(e){return{name:"followsEntity",order:50,state:{entity:0,offset:null,onTargetMissing:null},onAdd:function(e,r){var o=i().create();r.offset=r.offset?i().copy(o,r.offset):o,t(r),n(r)},onRemove:null,system:function(e,n){for(var r=0;r<n.length;r++)t(n[r])},renderSystem:function(e,t){for(var r=0;r<t.length;r++)n(t[r])}};function t(t){var n=t.__id,r=e.ents.getPositionData(n),o=e.ents.getPositionData(t.entity);o?i().add(r._localPosition,o._localPosition,t.offset):(t.onTargetMissing&&t.onTargetMissing(n),e.ents.removeComponent(n,e.ents.names.followsEntity))}function n(t){var n=t.__id,r=e.ents.getPositionData(n),o=e.ents.getPositionData(t.entity);o&&i().add(r._renderPosition,o._renderPosition,t.offset)}}function ie(e){return{name:"mesh",order:100,state:{mesh:null,offset:null},onAdd:function(t,n){var r=e.ents.getPositionData(t);if(!n.mesh)throw new Error("Mesh component added without a mesh - probably a bug!");e.rendering.addMeshToScene(n.mesh,!1,r.position),n.offset||(n.offset=i().create());var o=r._renderPosition;n.mesh.position.copyFromFloats(o[0]+n.offset[0],o[1]+n.offset[1],o[2]+n.offset[2])},onRemove:function(e,t){t.mesh.dispose()},renderSystem:function(t,n){for(var r=0;r<n.length;r++){var i=n[r],o=i.__id,s=e.ents.getPositionData(o)._renderPosition;i.mesh.position.copyFromFloats(s[0]+i.offset[0],s[1]+i.offset[1],s[2]+i.offset[2])}}}}function oe(){this.heading=0,this.running=!1,this.jumping=!1,this.maxSpeed=10,this.moveForce=30,this.responsiveness=15,this.runningFriction=0,this.standingFriction=2,this.airMoveMult=.5,this.jumpImpulse=10,this.jumpForce=12,this.jumpTime=500,this.airJumps=1,this._jumpCount=0,this._currjumptime=0,this._isJumping=!1}function se(e){return{name:"movement",order:30,state:new oe,onAdd:null,onRemove:null,system:function(t,n){for(var r=e.entities,i=0;i<n.length;i++){var o=n[i],s=r.getPhysics(o.__id);s&&he(t,o,s.body)}}}}var ae=i().create(),ue=i().create(),ce=i().create();function he(e,t,n){var r=n.atRestY()<0,o=r||t._jumpCount<t.airJumps;if(r&&(t._isJumping=!1,t._jumpCount=0),t.jumping)if(t._isJumping){if(t._currjumptime>0){var s=t.jumpForce;t._currjumptime<e&&(s*=t._currjumptime/e),n.applyForce([0,s,0]),t._currjumptime-=e}}else o&&(t._isJumping=!0,r||t._jumpCount++,t._currjumptime=t.jumpTime,n.applyImpulse([0,t.jumpImpulse,0]),!r&&n.velocity[1]<0&&(n.velocity[1]=0));else t._isJumping=!1;var a=ae,u=ue;if(t.running){var c=t.maxSpeed;i().set(a,0,0,c),i().rotateY(a,a,ce,t.heading),i().subtract(u,a,n.velocity),u[1]=0;var h=i().length(u);if(i().normalize(u,u),h>0){var l=t.moveForce;r||(l*=t.airMoveMult);var f=t.responsiveness*h;l>f&&(l=f),i().scale(u,u,l),n.applyForce(u)}n.friction=t.runningFriction}else n.friction=t.standingFriction}function le(e){return{name:"receivesInputs",order:20,state:{},onAdd:null,onRemove:null,system:function(t,n){for(var r=e.entities,i=e.inputs.state,o=e.camera.heading,s=0;s<n.length;s++){var a=n[s];fe(r.getMovement(a.__id),i,o)}}}}function fe(e,t,n){e.jumping=!!t.jump;var r=t.forward?t.backward?0:1:t.backward?-1:0,i=t.right?t.left?0:1:t.left?-1:0;0==(r|i)?e.running=!1:(e.running=!0,r?(-1==r&&(n+=Math.PI),i&&(n+=Math.PI/4*r*i)):n+=i*Math.PI/2,e.heading=n)}var de=n(4649),pe=n(1677),ve=n(1071);function me(e,t){var n=t,r=e.rendering.getScene(),i=(0,ve.u)("shadow",{radius:.75,tessellation:30},r);i.rotation.x=Math.PI/2;var o=e.rendering.makeStandardMaterial("shadowMat");return o.diffuseColor=de.Wo.Black(),o.ambientColor=de.Wo.Black(),o.alpha=.5,i.material=o,i.setEnabled(!1),o.freeze(),r.removeMesh(i),{name:"shadow",order:80,state:{size:.5,_mesh:null},onAdd:function(t,n){var r=i.createInstance("shadow_instance");e.rendering.addMeshToScene(r),r.setEnabled(!1),n._mesh=r},onRemove:function(e,t){t._mesh.dispose()},system:function(t,r){for(var i=e.camera._localGetPosition(),o=n,s=0;s<r.length;s++){var a=r[s],u=e.ents.getPositionData(a.__id),c=e.ents.getPhysics(a.__id);_e(e,u,c,a._mesh,a.size,o,i)}},renderSystem:function(t,n){for(var r=0;r<n.length;r++){var i=n[r],o=e.ents.getPositionData(i.__id)._renderPosition,s=i._mesh.position;s.x=o[0],s.z=o[2]}}}}n(7338);var ge=i().fromValues(0,0,0),ye=i().fromValues(0,-1,0);function _e(e,t,n,r,o,s,a){var u;if(n&&n.body.resting[1]<0)u=t._localPosition[1];else{var c=e._localPick(t._localPosition,ye,s);if(!c)return void r.setEnabled(!1);u=c.position[1]-e.worldOriginOffset[1]}u=Math.round(u),i().copy(ge,t._localPosition),ge[1]=u;var h=.01+i().squaredDistance(a,ge)/1600*.1;h>.1&&(h=.1),r.position.y=u+h;var l=.7*o*(1-(t._localPosition[1]-u)/s);r.scaling.copyFromFloats(l,l,l),r.setEnabled(!0)}function be(e){var t="smoothCamera";return{name:t,order:99,state:{time:100.1},onAdd:null,onRemove:null,system:function(n,r){for(var i=0;i<r.length;i++){var o=r[i];o.time-=n,o.time<0&&e.ents.removeComponent(o.__id,t)}}}}var ke={shadowDistance:10};class we extends(V()){constructor(e,t){super();var n={shadow:(t=Object.assign({},ke,t)).shadowDistance};this.noa=e,this.names={};var r={collideEntities:J,collideTerrain:ee,fadeOnZoom:te,followsEntity:re,mesh:ie,movement:se,physics:W,position:H,receivesInputs:le,shadow:me,smoothCamera:be};Object.keys(r).forEach((t=>{var i=(0,r[t])(e,n[t]||void 0);this.names[t]=this.createComponent(i)})),this.cameraSmoothed=this.getComponentAccessor(this.names.smoothCamera),this.hasPhysics=this.getComponentAccessor(this.names.physics),this.hasPosition=this.getComponentAccessor(this.names.position),this.getPositionData=this.getStateAccessor(this.names.position),this.getPosition=e=>{var t=this.getPositionData(e);return t?t.position:null},this.getPhysics=this.getStateAccessor(this.names.physics),this.getPhysicsBody=e=>{var t=this.getPhysics(e);return t?t.body:null},this.hasMesh=this.getComponentAccessor(this.names.mesh),this.getMeshData=this.getStateAccessor(this.names.mesh),this.getMovement=this.getStateAccessor(this.names.movement),this.getCollideTerrain=this.getStateAccessor(this.names.collideTerrain),this.getCollideEntities=this.getStateAccessor(this.names.collideEntities),this.onPairwiseEntityCollision=function(e,t){}}setPosition(e,t,n=0,r=0){"number"==typeof t&&(t=[t,n,r]);var i=this.noa.globalToLocal(t,null,[]);this._localSetPosition(e,i)}setEntitySize(e,t,n,r){var i=this.getPositionData(e);i.width=(t+r)/2,i.height=n,this._updateDerivedPositionData(e,i)}_rebaseOrigin(e){for(var t of this.getStatesList(this.names.position)){var n=t._localPosition,r=t.width/2;xe(n,0,-r,r,t.__id),xe(n,1,0,t.height,t.__id),xe(n,2,-r,r,t.__id),i().subtract(n,n,e),this._updateDerivedPositionData(t.__id,t)}}_localGetPosition(e){return this.getPositionData(e)._localPosition}_localSetPosition(e,t){var n=this.getPositionData(e);i().copy(n._localPosition,t),this._updateDerivedPositionData(e,n)}_updateDerivedPositionData(e,t){i().copy(t._renderPosition,t._localPosition);var n=this.noa.worldOriginOffset;i().add(t.position,t._localPosition,n),K(t);var r=this.getPhysics(e);r&&Y(r,t)}addComponentAgain(e,t,n){this.hasComponent(e,t)&&this.removeComponent(e,t),this.addComponent(e,t,n)}isTerrainBlocked(e,t,n){for(var r=this.noa.worldOriginOffset,i=Math.floor(e-r[0]),o=Math.floor(t-r[1]),s=Math.floor(n-r[2]),a=[i+.001,o+.001,s+.001,i+.999,o+.999,s+.999],u=this.getStatesList(this.names.collideTerrain),c=0;c<u.length;c++){var h=u[c].__id;if(Me(a,this.getPositionData(h)._extents))return!0}return!1}getEntitiesInAABB(e,t){var n,r=this.noa.worldOriginOffset,i=[e.base[0]-r[0],e.base[1]-r[1],e.base[2]-r[2],e.max[0]-r[0],e.max[1]-r[1],e.max[2]-r[2]];if(t)for(var o of(n=[],this.getStatesList(t))){var s=this.getPositionData(o.__id);s&&n.push(s)}else n=this.getStatesList(this.names.position);for(var a=[],u=0;u<n.length;u++){var c=n[u];Me(i,c._extents)&&a.push(c.__id)}return a}add(e=null,t=1,n=1,r=null,o=null,s=!1,a=!1){var u=this,c=this.createEntity();if(this.addComponent(c,this.names.position,{position:e||i().create(),width:t,height:n}),s){this.addComponent(c,this.names.physics);var h=this.getPhysics(c).body,l=this.names.smoothCamera;h.onStep=function(){u.addComponentAgain(c,l)}}return r&&(o||(o=i().create()),this.addComponent(c,this.names.mesh,{mesh:r,offset:o})),a&&this.addComponent(c,this.names.shadow,{size:t}),c}}function xe(e,t,n,r,i){var o=e[t]+n,s=e[t]+r;Math.abs(o-Math.round(o))<.002&&(e[t]+=.002),Math.abs(s-Math.round(s))<.001&&(e[t]-=.001)}function Me(e,t){return!(e[0]>t[3]||e[1]>t[4]||e[2]>t[5]||e[3]<t[0]||e[4]<t[1]||e[5]<t[2])}var Ce=n(202),Pe=n(4674);n(2708);const Ie=function(e){this.rootNode=new Pe.Y("objectMeshRoot",e.rendering._scene);var t=[0,0,0],n=!1,r=new Pe.Y(""),i={},o=t=>{if(i[t])return i[t];var n=e.registry._blockMeshLookup[t];for(var r in i){var o=i[r].mesh;if(o===n||o.geometry===n.geometry)return i[t]=i[r]}return i[t]=new De(e,n)};this.initChunk=function(e){e._objectBlocks={}},this.setObjectBlock=function(n,i,s,a,u){var c=n.x+s,h=n.y+a,l=n.z+u,f=(0,Ce.wX)(c,h,l),d=n._objectBlocks[f]||0;if(d!==i){if(d>0&&o(d).removeInstance(n,f),i>0){var p=e.registry._blockHandlerLookup[i],v=p&&p.onCustomMeshCreate;v&&(r.position.copyFromFloats(.5,0,.5),r.scaling.setAll(1),r.rotation.setAll(0),v(r,c,h,l));var m=o(i),g=v?r:null;m.addInstance(n,f,s,a,u,g,t)}d>0&&!i&&delete n._objectBlocks[f],i>0&&(n._objectBlocks[f]=i)}},this.buildObjectMeshes=function(){for(var e in Ae("start"),i){var t=i[e];t.updateMatrix(),0===t.count&&t.dispose(),t.disposed&&delete i[e]}Ae("rebuilt"),Ae("end")},this.disposeChunk=function(e){for(var t in e._objectBlocks){var r=e._objectBlocks[t];r>0&&o(r).removeInstance(e,t)}e._objectBlocks=null,n=!0},this.tick=function(){n&&(this.buildObjectMeshes(),n=!1)},this._rebaseOrigin=function(e){for(var r in t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],i)i[r].rebased=!1;for(var o in i){var s=i[o];if(!s.rebased){for(var a=0;a<s.count;a++){var u=a<<4;s.buffer[u+12]-=e[0],s.buffer[u+13]-=e[1],s.buffer[u+14]-=e[2]}s.rebased=!0,s.dirty=!0}}n=!0}};function De(e,t){this.mesh=t,this.buffer=null,this.capacity=0,this.count=0,this.dirty=!1,this.rebased=!0,this.disposed=!1,this.keyToIndex={},this.locToKey=[],this.mesh.position.setAll(0),this.mesh.parent=e._objectMesher.rootNode,this.mesh.isVisible=!0,e.rendering.addMeshToScene(this.mesh,!1),this.mesh.doNotSyncBoundingInfo=!0,this.mesh.alwaysSelectAsActiveMesh=!0}De.prototype.dispose=function(){this.disposed||(this.mesh.thinInstanceCount=0,this.setCapacity(0),this.mesh.isVisible=!1,this.mesh=null,this.keyToIndex=null,this.locToKey=null,this.disposed=!0)},De.prototype.addInstance=function(e,t,n,r,i,o,s){!function(e){if(!(e.count<e.capacity)){var t=Math.max(8,2*e.capacity);e.setCapacity(t)}}(this);var a=this.count<<4;if(this.locToKey[this.count]=t,this.keyToIndex[t]=a,o)o.position.x+=e.x-s[0]+n,o.position.y+=e.y-s[1]+r,o.position.z+=e.z-s[2]+i,o.computeWorldMatrix(!0),Le(o._localMatrix._m,0,this.buffer,a);else{var u=Te;u[12]=e.x-s[0]+n+.5,u[13]=e.y-s[1]+r,u[14]=e.z-s[2]+i+.5,Le(u,0,this.buffer,a)}this.count++,this.dirty=!0},De.prototype.removeInstance=function(e,t){var n=this.keyToIndex[t];if(!(n>=0))throw"tried to remove object instance not in storage";delete this.keyToIndex[t];var r,i=n>>4,o=this.count-1;if(i!==o){var s=o<<4;Le(this.buffer,s,this.buffer,n);var a=this.locToKey[o];this.keyToIndex[a]=n,this.locToKey[i]=a}this.count--,this.dirty=!0,(r=this).count>.4*r.capacity||r.capacity<100||(r.setCapacity(Math.round(r.capacity/2)),r.locToKey.length=Math.min(r.locToKey.length,r.capacity))},De.prototype.updateMatrix=function(){this.dirty&&(this.mesh.thinInstanceCount=this.count,this.mesh.thinInstanceBufferUpdated("matrix"),this.mesh.isVisible=this.count>0,this.dirty=!1)},De.prototype.setCapacity=function(e=4){if(this.capacity=e,0===e)this.buffer=null;else{var t=new Float32Array(16*this.capacity);if(this.buffer)for(var n=Math.min(this.buffer.length,t.length),r=0;r<n;r++)t[r]=this.buffer[r];this.buffer=t}this.mesh.thinInstanceSetBuffer("matrix",this.buffer),this.mesh.thinInstanceCount=this.count,this.dirty=!1};var Te=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function Le(e,t,n,r){for(var i=0;i<16;i++)n[r+i]=e[t+i]}var Ae=()=>{},Ee=n(2101),Se=n(1537),je=n(3107);class Re{constructor(e){this.noa=e,this._idCounter=1e3,this._blockMatIDtoTerrainID={},this._terrainIDtoMatObject={},this._texURLtoTerrainID={},this._renderMatToTerrainID=new Map}getTerrainMatId(e){if(e in this._blockMatIDtoTerrainID)return this._blockMatIDtoTerrainID[e];var t=function(e,t=0){var n=e.noa.registry.getMaterialData(t);if(n.renderMat){var r=n.renderMat;return e._renderMatToTerrainID.has(r)||e._renderMatToTerrainID.set(r,e._idCounter++),e._renderMatToTerrainID.get(r)}if(n.texture){var i=n.texture;return i in e._texURLtoTerrainID||(e._texURLtoTerrainID[i]=e._idCounter++),e._texURLtoTerrainID[i]}var o=n.alpha;return o>0&&o<1?10+Math.round(100*o):1}(this,e);if(!(t in this._terrainIDtoMatObject)){var n=function(e,t=0){var n=e.noa.registry.getMaterialData(t);if(n.renderMat)return n.renderMat;if(!n.texture){var r=n.alpha>0&&n.alpha<1,i="terrain-base-"+t;r&&(i+="-alpha");var o=e.noa.rendering.makeStandardMaterial(i);return r&&(o.alpha=n.alpha),o.freeze(),o}var s=e.noa.rendering.getScene(),a=e.noa.rendering.makeStandardMaterial("terrain-textured-"+t),u=n.texture,c=je.xEZ.NEAREST_SAMPLINGMODE,h=new je.xEZ(u,s,!0,!1,c);return n.texHasAlpha&&(h.hasAlpha=!0),a.diffuseTexture=h,n.atlasIndex>=0&&new Oe(a,h),a.freeze(),a}(this,e);this._terrainIDtoMatObject[t]=n}return this._blockMatIDtoTerrainID[e]=t,t}getMaterial(e=1){return this._terrainIDtoMatObject[e]}}class Oe extends je.neh{constructor(e,t){super(e,"TestPlugin",200,{NOA_TWOD_ARRAY_TEXTURE:!1}),this._enable(!0),this._atlasTextureArray=null,t.onLoadObservable.add((e=>{this.setTextureArrayData(e)}))}setTextureArrayData(e){var{width:t,height:n}=e.getSize(),r=Math.round(n/t);n=t;var i=e._readPixelsSync(),o=Se.D.TEXTUREFORMAT_RGBA,s=je.xEZ.NEAREST_SAMPLINGMODE,a=e.getScene();this._atlasTextureArray=new je.eoS(i,t,n,r,o,a,!0,!1,s)}prepareDefines(e,t,n){e.NOA_TWOD_ARRAY_TEXTURE=!0}getClassName(){return"TerrainMaterialPluginName"}getSamplers(e){e.push("atlasTexture")}getAttributes(e){e.push("texAtlasIndices")}getUniforms(){return{ubo:[]}}bindForSubMesh(e,t,n,r){this._atlasTextureArray&&e.setTexture("atlasTexture",this._atlasTextureArray)}getCustomCode(e){return"vertex"===e?{CUSTOM_VERTEX_MAIN_BEGIN:"\n                texAtlasIndex = texAtlasIndices;\n            ",CUSTOM_VERTEX_DEFINITIONS:"\n                uniform highp sampler2DArray atlasTexture;\n                attribute float texAtlasIndices;\n                varying float texAtlasIndex;\n            "}:"fragment"===e?{"!baseColor\\=texture2D\\(diffuseSampler,vDiffuseUV\\+uvOffset\\);":"baseColor = texture(atlasTexture, vec3(vDiffuseUV, texAtlasIndex));",CUSTOM_FRAGMENT_DEFINITIONS:"\n                uniform highp sampler2DArray atlasTexture;\n                varying float texAtlasIndex;\n            "}:null}}const Fe=function(e){var t=new Re(e),n=new qe(e,t),r=new Ve(e,t);this.initChunk=function(e){e._terrainMeshes.length=0},this.meshChunk=function(t,i,o,a,u,c,h){He("start"),t._terrainMeshes.forEach((e=>e.dispose())),t._terrainMeshes.length=0,He("cleanup");var l=i||e.registry.getBlockFaceMaterial,f=o||e.registry._getMaterialVertexColor,d=void 0===u?e.rendering.useAO:u,p=c||e.rendering.aoVals,v=isNaN(h)?e.rendering.revAoVal:h,m=function(e){var t=e.voxels.shape[0],n=ze;if(t+2!==n.shape[0]){var r=t+2;n=new(s())(new Uint16Array(r*r*r),[r,r,r]),ze=n}var i=Ue[0],o=Ue[1],a=Ue[2],u=Ue[3],c=Ue[4],h=Ue[5],l=Ue[6];t!==Be&&(Be=t,function(e,t,n,r){for(var i=0;i<3;i++)t[i]=[e-1,0,0][i],n[i]=[1,e,1][i],r[i]=[0,1,e+1][i]}(t,c,h,l));for(var f=0;f<3;f++){i[0]=f;for(var d=0;d<3;d++){i[1]=d;for(var p=0;p<3;p++){i[2]=p;for(var v=0;v<3;v++){var m=i[v];o[v]=c[m],a[v]=h[m],u[v]=l[m]}var g=e._neighbors.get(f-1,d-1,p-1),y=0;g&&(y=g._filledWithVoxel>=0?g._filledWithVoxel:g.voxels),(0,Ce.Fx)(y,n,o,a,u)}}}return n}(t);He("copy");var g=t._isFull||t._isEmpty,y=n.mesh(m,l,f,d,p,v,g);He("geom");var _=r.build(t,y,a);He("build"),He("end"),_.forEach((n=>{e.rendering.addMeshToScene(n,!0,t.pos,this),n.cullingStrategy=pe.Kj.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,t._terrainMeshes.push(n)}))},this.disposeChunk=function(e){e._terrainMeshes.forEach((e=>e.dispose())),e._terrainMeshes.length=0}};var Be,ze=new(s())(new Uint16Array(27),[3,3,3]),Ue=Array.from(Array(10),(()=>[0,0,0]));function Ne(e){this.terrainID=e,this.numQuads=0,this.quadMaterials=[1],this.positions=[.5],this.indices=[1],this.normals=[.5],this.colors=[.5],this.uvs=[.5],this.atlasIndices=[0]}function Ve(e,t){this.build=function(n,r,i){var o=e.rendering.getScene(),s=[];for(var a in r){var u=r[a];if(0===u.numQuads)throw"?";var c=`chunk_${n.requestID}_${u.terrainID}`,h=new pe.Kj(c,o),l=new Ee.x;l.positions=u.positions,l.indices=u.indices,l.normals=u.normals,l.colors=u.colors,l.uvs=u.uvs,l.applyToMesh(h),u.atlasIndices.length>1&&h.setVerticesData("texAtlasIndices",u.atlasIndices,!1,1),h.material=t.getMaterial(u.terrainID),u.dispose(),s.push(h)}return s}}function qe(e,t){var n=new Int16Array(16),r=new Uint16Array(16),i=e.registry._solidityLookup,o=e.registry._opacityLookup,s=e=>t.getTerrainMatId(e),a=t=>e.registry.getMaterialData(t).atlasIndex;function u(e,t,i,o,s,a){for(var u=i.shape[1],h=n,l=r,f=0,d=2*t,p=i.data,v=i.index(e-1,0,0),m=i.stride[0],g=i.stride[1],y=i.stride[2],_=0;_<u;++_){var b=v;v+=y;for(var w=0;w<u;w++,f++,b+=g){var x=p[b],M=p[b+m];if(x!==M){var C=c(x,M,o,d);C&&(h[f]=C>0?o(x,d):-o(M,d+1),s&&(l[f]=C>0?k(i,e,e-1,w,_,a):k(i,e-1,e,w,_,a)))}}}}function c(e,t,n,r){var i=o[e],s=o[t];if(i&&s)return 0;if(i)return 1;if(s)return-1;var a=n(e,r),u=n(t,r+1);return a===u?0:0===a?-1:0===u?1:0}function h(e,t,i,o,u,c,h,v,k,w,x){var M=0,C=n,P=r,I=[0,0,0],D=[0,0,0],T=[0,0,0];I[t]=e;for(var L=[0,0,0],A=h?g:y,E=h?b:_,S=0;S<c;++S)for(var j=1,R=1,O=0;O<u;O+=j,M+=j){var F=0|C[M];if(F){var B=0|P[M];for(j=1;j<u-O&&A(M+j,C,F,P,B);++j);e:for(R=1;R<c-S;++R)for(var z=0;z<j;++z)if(!A(M+z+R*u,C,F,P,B))break e;var U=Math.abs(F),N=s(U);N in v||(v[N]=new Ne(N));var V=v[N],q=V.numQuads,H=a(U);H>=0&&m(V.atlasIndices,4*q,H);var K=E(V.colors,16*q,k(U),B,w,x);I[i]=O,I[o]=S,D[i]=j,T[o]=R,l(V.positions,12*q,I,D,T);var G=F>0?1:-1;f(V.uvs,8*q,t,j,R,G),L[t]=G,d(V.normals,12*q,L),p(V.indices,6*q,4*q,F,K),V.numQuads++;for(var W=0;W<R;++W)for(var Z=0;Z<j;++Z)C[M+Z+W*u]=0}else j=1}}function l(e,t,n,r,i){for(var o=0;o<3;o++)e[t+o]=n[o],e[t+3+o]=n[o]+r[o],e[t+6+o]=n[o]+r[o]+i[o],e[t+9+o]=n[o]+i[o]}function f(e,t,n,r,i,o){for(var s=0;s<8;s++)e[t+s]=0;2===n?(e[t+1]=e[t+3]=i,e[t+2]=e[t+4]=-o*r):(e[t+1]=e[t+7]=r,e[t+4]=e[t+6]=o*i)}function d(e,t,n){for(var r=0;r<12;r++)e[t+r]=n[r%3]}function p(e,t,n,r,i){for(var o=r<0?i?v.A:v.B:i?v.C:v.D,s=0;s<6;s++)e[t+s]=n+o[s]}this.mesh=function(t,s,a,c,l,f,d){i=e.registry._solidityLookup,o=e.registry._opacityLookup;for(var p={},v=f===l[0],m=0;m<3;++m){var g=(m+1)%3,y=(m+2)%3,_=t.shape,b=t.transpose(m,g,y).lo(1,1,1).hi(_[m]-2,_[g]-2,_[y]-2),k=b.shape[0]-1,w=b.shape[1],x=b.shape[2];n.length<w*x&&(n=new Int16Array(w*x),r=new Uint16Array(w*x));for(var M=0;M<=k;++M)u(M,m,b,s,c,v),h(M,m,g,y,w,x,c,p,a,l,f),d&&(M+=k-1)}return p};var v={A:[0,1,2,0,2,3],B:[1,2,3,0,1,3],C:[0,2,1,0,3,2],D:[3,1,0,3,2,1]};function m(e,t,n){for(var r=0;r<4;r++)e[t+r]=n}function g(e,t,n,r,i){return n===t[e]&&i===r[e]}function y(e,t,n,r,i){return n===t[e]}function _(e,t,n,r,i,o){for(var s=0;s<16;s+=4)e[t+s]=n[0],e[t+s+1]=n[1],e[t+s+2]=n[2],e[t+s+3]=1;return!0}function b(e,t,n,r,i,o){var s=w(r,0,0),a=w(r,1,0),u=w(r,1,1),c=w(r,0,1);return x(e,t,n,s,i,o),x(e,t+4,n,a,i,o),x(e,t+8,n,u,i,o),x(e,t+12,n,c,i,o),s===u?c!==a||2===c:c!==a&&s+u>c+a}function k(e,t,n,r,o,s){var a=1,u=1,c=1,h=1;return i[e.get(t,r+1,o)]&&(++c,++h),i[e.get(t,r-1,o)]&&(++a,++u),i[e.get(t,r,o+1)]&&(++u,++h),i[e.get(t,r,o-1)]&&(++a,++c),i[e.get(t,r,o)]?(h=3===h||i[e.get(t,r+1,o+1)]?3:2,u=3===u||i[e.get(t,r-1,o+1)]?3:2,h<<6|(c=3===c||i[e.get(t,r+1,o-1)]?3:2)<<4|u<<2|(a=3===a||i[e.get(t,r-1,o-1)]?3:2)):s?(1===h&&i[e.get(t,r+1,o+1)]&&(h=2),1===u&&i[e.get(t,r-1,o+1)]&&(u=2),1===c&&i[e.get(t,r+1,o-1)]&&(c=2),1===a&&i[e.get(t,r-1,o-1)]&&(a=2),h<<6|c<<4|u<<2|a):(1===h&&(i[e.get(t,r+1,o+1)]?h=2:i[e.get(n,r,o+1)]&&i[e.get(n,r+1,o)]&&i[e.get(n,r+1,o+1)]||(h=0)),1===c&&(i[e.get(t,r+1,o-1)]?c=2:i[e.get(n,r,o-1)]&&i[e.get(n,r+1,o)]&&i[e.get(n,r+1,o-1)]||(c=0)),1===u&&(i[e.get(t,r-1,o+1)]?u=2:i[e.get(n,r,o+1)]&&i[e.get(n,r-1,o)]&&i[e.get(n,r-1,o+1)]||(u=0)),1===a&&(i[e.get(t,r-1,o-1)]?a=2:i[e.get(n,r,o-1)]&&i[e.get(n,r-1,o)]&&i[e.get(n,r-1,o-1)]||(a=0)),h<<6|c<<4|u<<2|a)}function w(e,t,n){return e>>(t?n?6:4:n?2:0)&3}function x(e,t,n,r,i,o){var s=0===r?o:i[r-1];e[t]=n[0]*s,e[t+1]=n[1]*s,e[t+2]=n[2]*s,e[t+3]=1}}Ne.prototype.dispose=function(){this.quadMaterials=null,this.positions=null,this.indices=null,this.normals=null,this.colors=null,this.uvs=null,this.atlasIndices=null};var He=()=>{},Ke={texturePath:""};class Ge{constructor(e,t){t=Object.assign({},Ke,t),this.noa=e,this._texturePath=t.texturePath;var n={},r=[!1],i=[!1],o=[!1],s=[!1],a=[null],u=[null],c=[null],h=[!1],l=[0,0,0,0,0,0],f=[];this.registerBlock=function(e=1,t=null){var f=new Ye(t&&t.fluid),d=Object.assign({},f,t||{});if(e<1||e>65535)throw"Block id out of range: "+e;for(;e>r.length;)this.registerBlock(r.length,{});r[e]=!!d.solid,i[e]=!!d.opaque,o[e]=!!d.fluid,s[e]=!!d.blockMesh,u[e]=d.blockMesh||null;var p,v=d.material||null;if(v)if("string"==typeof v)p=[v,v,v,v,v,v];else if(v.length&&2==v.length)p=[v[1],v[1],v[0],v[0],v[1],v[1]];else if(v.length&&3==v.length)p=[v[2],v[2],v[0],v[1],v[2],v[2]];else{if(!v.length||6!=v.length)throw"Invalid material parameter: "+v;p=v}else p=[null,null,null,null,null,null];for(var m=0;m<6;++m)l[6*e+m]=We(this,n,p[m],!0);a[e]={},o[e]&&(a[e].fluidDensity=d.fluidDensity,a[e].viscosity=d.viscosity);var g=d.onLoad||d.onUnload||d.onSet||d.onUnset||d.onCustomMeshCreate;c[e]=g?new Ze(d):null;var y=r[e]&&i[e]&&!g&&!o[e]&&!s[e];return h[e]=y,e},this.registerMaterial=function(e="?",t=null){if(Array.isArray(t)||arguments[2])throw'This API changed signatures in v0.33, please use: `noa.registry.registerMaterial("name", optionsObj)`';var r=Object.assign(new Xe,t||{}),i=n[e]||f.length;n[e]=i;var o=1,s=r.color||[1,1,1];return 4===s.length&&(o=s.pop()),f[i]={color:s,alpha:o,texture:r.textureURL?this._texturePath+r.textureURL:"",texHasAlpha:!!r.texHasAlpha,atlasIndex:r.atlasIndex,renderMat:r.renderMaterial},i},this.getBlockSolidity=function(e){return r[e]},this.getBlockOpacity=function(e){return i[e]},this.getBlockFluidity=function(e){return o[e]},this.getBlockProps=function(e){return a[e]},this.getBlockFaceMaterial=function(e,t){return l[6*e+t]},this.getMaterialColor=function(e){return f[e].color},this.getMaterialTexture=function(e){return f[e].texture},this.getMaterialData=function(e){return f[e]},this._solidityLookup=r,this._opacityLookup=i,this._fluidityLookup=o,this._objectLookup=s,this._blockMeshLookup=u,this._blockHandlerLookup=c,this._blockIsPlainLookup=h,this._getMaterialVertexColor=e=>f[e].texture?d:f[e].color;var d=[1,1,1];this.registerMaterial("dirt",{color:[.4,.3,0]}),this.registerBlock(1,{material:"dirt"})}}function We(e,t,n,r){if(!n)return 0;var i=t[n];return void 0===i&&r&&(i=e.registerMaterial(n)),i}function Ze(e){this.onLoad=e.onLoad||null,this.onUnload=e.onUnload||null,this.onSet=e.onSet||null,this.onUnset=e.onUnset||null,this.onCustomMeshCreate=e.onCustomMeshCreate||null}function Ye(e=!1){this.solid=!e,this.opaque=!e,this.fluid=!1,this.material=null,this.blockMesh=null,this.fluidDensity=1,this.viscosity=.5,this.onLoad=null,this.onUnload=null,this.onSet=null,this.onUnset=null,this.onCustomMeshCreate=null}function Xe(){this.color=null,this.textureURL=null,this.texHasAlpha=!1,this.atlasIndex=-1,this.renderMaterial=null}var $e=n(4141),Qe=n(2847),Je=n(9813),et=n(9266);class tt{constructor(e,t){var n=e._scene;n._addComponent(new et.Zb(n));var r=new Qe.V(o);n._selectionOctree=r,r.blocks=[];var i={};this.rebase=e=>{a(r,e)},this.includesMesh=e=>e._noaContainingBlock||e._noaIsDynamicContent,this.addMesh=(t,n,o,a)=>{if(!n)return t._noaIsDynamicContent=!0,void r.dynamicContent.push(t);var c=Math.floor(o[0]/s),h=Math.floor(o[1]/s),l=Math.floor(o[2]/s),f=(0,Ce.wX)(c,h,l),d=i[f];if(!d){var p=[c*s,h*s,l*s],v=[0,0,0];e.noa.globalToLocal(p,null,v),d=u(v,s),r.blocks.push(d),i[f]=d,d._noaMapKey=f}d.entries.push(t),t._noaContainingBlock=d,t.alwaysSelectAsActiveMesh=!0},this.removeMesh=e=>{if(e._noaIsDynamicContent&&(e._noaIsDynamicContent=null,(0,Ce.xP)(r.dynamicContent,e)),e._noaContainingBlock){e._noaContainingChunk=null;var t=e._noaContainingBlock;(0,Ce.xP)(t.entries,e),0===t.entries.length&&(delete i[t._noaMapKey],(0,Ce.xP)(r.blocks,t))}};var o=()=>{},s=t*e.noa.world._chunkSize,a=(e,t)=>{e.blocks.forEach((e=>{e.minPoint.subtractInPlace(t),e.maxPoint.subtractInPlace(t),e._boundingVectors.forEach((e=>e.subtractInPlace(t))),e.blocks&&a(e,t)}))},u=(e,t)=>{var n=new $e.P(e[0],e[1],e[2]),r=new $e.P(e[0]+t,e[1]+t,e[2]+t);return new Je.b(n,r,void 0,void 0,void 0,o)}}}var nt=n(7987),rt=n(1717),it=n(7616),ot=n(252),st=n(2573),at=n(3615),ut=n(8010),ct={showFPS:!1,antiAlias:!0,clearColor:[.8,.9,1],ambientColor:[1,1,1],lightDiffuse:[1,1,1],lightSpecular:[1,1,1],groundLightColor:[.5,.5,.5],useAO:!0,AOmultipliers:[.93,.8,.5],reverseAOmultiplier:1,preserveDrawingBuffer:!0,octreeBlockSize:2,renderOnResize:!0};class ht{constructor(e,t,n){t=Object.assign({},ct,t),this.noa=e,this.renderOnResize=!!t.renderOnResize,this.useAO=!!t.useAO,this.aoVals=t.AOmultipliers,this.revAoVal=t.reverseAOmultiplier,this.meshingCutoffTime=6,this._scene=null,this._engine=null,this._octreeManager=null,this.initScene(n,t),t.showFPS&&function(){var e=document.createElement("div");e.id="noa_fps",e.style.position="absolute",e.style.top="0",e.style.right="0",e.style.zIndex="0",e.style.color="white",e.style.backgroundColor="rgba(0,0,0,0.5)",e.style.font="14px monospace",e.style.textAlign="center",e.style.minWidth="2em",e.style.margin="4px",document.body.appendChild(e);var t=0,n=0,r=performance.now(),i=r;dt=function(){t++;var o=performance.now();if(o-i>n&&(n=o-i),i=o,!(o-r<1e3)){var s=Math.round(t/(o-r)*1e3),a=Math.round(1/n*1e3);e.innerHTML=s+"<br>"+a,t=0,n=0,r=o}}}()}initScene(e,t){this._engine=new Se.D(e,t.antiAlias,{preserveDrawingBuffer:t.preserveDrawingBuffer}),this._scene=new nt.x(this._engine);var n=this._scene;n.detachControl();var r=Math.round(t.octreeBlockSize);this._octreeManager=new tt(this,r),this._cameraHolder=new Pe.Y("camHolder",n),this._camera=new rt.c("camera",new $e.P(0,0,0),n),this._camera.parent=this._cameraHolder,this._camera.minZ=.01,this._camScreen=(0,at.pT)("camScreen",{size:10},n),this.addMeshToScene(this._camScreen),this._camScreen.position.z=.1,this._camScreen.parent=this._camera,this._camScreenMat=this.makeStandardMaterial("camscreenmat"),this._camScreen.material=this._camScreenMat,this._camScreen.setEnabled(!1),this._camScreenMat.freeze(),this._camLocBlock=0;var i=new $e.P(.1,1,.3);function o(e){return new de.Wo(e[0],e[1],e[2])}this._light=new it.e("light",i,n),n.clearColor=de.HE.FromColor3(o(t.clearColor)),n.ambientColor=o(t.ambientColor),this._light.diffuse=o(t.lightDiffuse),this._light.specular=o(t.lightSpecular),this._light.groundColor=o(t.groundLightColor),n.skipPointerMovePicking=!0}}ht.prototype.getScene=function(){return this._scene},ht.prototype.tick=function(e){},ht.prototype.render=function(){ft("start"),function(e){var t=e.noa.camera,n=t._localGetTargetPosition();e._cameraHolder.position.copyFromFloats(n[0],n[1],n[2]),e._cameraHolder.rotation.x=t.pitch,e._cameraHolder.rotation.y=t.heading,e._camera.position.z=-t.currentZoom;var r=t._localGetPosition(),i=e.noa.worldOriginOffset,o=Math.floor(r[0]+i[0]),s=Math.floor(r[1]+i[1]),a=Math.floor(r[2]+i[2]),u=e.noa.getBlock(o,s,a);!function(e,t){if(t!==e._camLocBlock){if(0===t)e._camScreen.setEnabled(!1);else{var n=e.noa.registry.getBlockFaceMaterial(t,0);if(n){var r=e.noa.registry.getMaterialData(n),i=r.color,o=r.alpha;i&&o&&o<1&&(e._camScreenMat.diffuseColor.set(0,0,0),e._camScreenMat.ambientColor.set(i[0],i[1],i[2]),e._camScreenMat.alpha=o,e._camScreen.setEnabled(!0))}}e._camLocBlock=t}}(e,u)}(this),ft("updateCamera"),this._engine.beginFrame(),ft("beginFrame"),this._scene.render(),ft("render"),dt(),this._engine.endFrame(),ft("endFrame"),ft("end")},ht.prototype.postRender=function(){},ht.prototype.resize=function(){this._engine.resize(),this.noa._paused&&this.renderOnResize&&this._scene.render()},ht.prototype.highlightBlockFace=function(e,t,n){var r=function(e){var t=e._highlightMesh;if(!t){t=(0,at.pT)("highlight",{size:1},e._scene);var n=e.makeStandardMaterial("highlightMat");n.backFaceCulling=!1,n.emissiveColor=new de.Wo(1,1,1),n.alpha=.2,n.freeze(),t.material=n;var r=.5,i=(0,st.nL)("hightlightLines",{points:[new $e.P(r,r,0),new $e.P(r,-r,0),new $e.P(-r,-r,0),new $e.P(-r,r,0),new $e.P(r,r,0)]},e._scene);i.color=new de.Wo(1,1,1),i.parent=t,e.addMeshToScene(t),e.addMeshToScene(i),e._highlightMesh=t}return t}(this);if(e){this.noa.globalToLocal(t,null,lt);for(var i=.001+.001*ut.dist(this.noa.camera._localGetPosition(),lt),o=0;o<3;o++)0===n[o]?lt[o]+=.5:lt[o]+=n[o]>0?1+i:-i;r.position.copyFromFloats(lt[0],lt[1],lt[2]),r.rotation.x=n[1]?Math.PI/2:0,r.rotation.y=n[0]?Math.PI/2:0}r.setEnabled(e)};var lt=[];ht.prototype.addMeshToScene=function(e,t=!1,n=null,r=null){if(!this._octreeManager.includesMesh(e)){if(!e.parent){n||(n=[e.position.x,e.position.y,e.position.z]);var i=[];this.noa.globalToLocal(n,null,i),e.position.copyFromFloats(i[0],i[1],i[2])}t&&(e.freezeWorldMatrix(),e.freezeNormals&&e.freezeNormals(),e.doNotSyncBoundingInfo=!0),this._octreeManager.addMesh(e,t,n,r),e.onDisposeObservable.add((()=>{this._octreeManager.removeMesh(e)}))}},ht.prototype.makeStandardMaterial=function(e){var t=new ot.K(e,this._scene);return t.specularColor.copyFromFloats(0,0,0),t.ambientColor.copyFromFloats(1,1,1),t.diffuseColor.copyFromFloats(1,1,1),this.postMaterialCreationHook(t),t},ht.prototype.postMaterialCreationHook=function(e){},ht.prototype.prepareChunkForRendering=function(e){},ht.prototype.disposeChunkForRendering=function(e){},ht.prototype._rebaseOrigin=function(e){var t=new $e.P(e[0],e[1],e[2]);this._scene.meshes.forEach((e=>{e.parent||(e.position.subtractInPlace(t),e.isWorldMatrixFrozen&&e.freezeWorldMatrix())})),this._octreeManager.rebase(t)},ht.prototype.debug_SceneCheck=function(){var e=this._scene.meshes,t=this._scene._selectionOctree,n=t.dynamicContent,r=[],i=0,o=0,s=this._scene.materials,a=[];s.forEach((e=>{e.subMaterials?e.subMaterials.forEach((e=>a.push(e))):a.push(e)})),t.blocks.forEach((function(e){i++,e.entries.forEach((e=>r.push(e)))})),e.forEach((function(e){if(e.isDisposed&&h(e,"disposed mesh in scene"),!function(e){return 0===e.getIndices().length}(e))if(l(e,n,r)&&h(e,"non-empty mesh missing from octree"),e.material){o+=e.subMeshes?e.subMeshes.length:1;var t=e.material.subMaterials||[e.material];t.forEach((function(e){l(e,t)&&h(e,"mesh material not in scene")}))}else h(e,"non-empty scene mesh with no material")}));var u=[];a.forEach((t=>{var n=!1;e.forEach((e=>{e.material===t&&(n=!0),e.material&&(e.material.subMaterials||[e.material]).includes(t)&&(n=!0)})),n||u.push(t.name)})),u.length&&console.warn("Materials unused by any mesh: ",u.join(", ")),n.forEach((function(t){l(t,e)&&h(t,"octree/dynamic mesh not in scene")})),r.forEach((function(t){l(t,e)&&h(t,"octree block mesh not in scene")}));var c=Math.round(10*r.length/i)/10;function h(e,t){console.warn(e.name+" --- "+t)}function l(e,t,n){return!(!e||t.includes(e)||n&&n.includes(e))}return console.log("meshes - octree:",r.length,"  dynamic:",n.length,"   subMeshes:",o,"   avg meshes/octreeBlock:",c),"done."},ht.prototype.debug_MeshCount=function(){var e={};for(var t in this._scene.meshes.forEach((t=>{var n=t.name||"";n=(n=(n=(n=n.replace(/-\d+.*/,"#")).replace(/\d+.*/,"#")).replace(/(rotHolder|camHolder|camScreen)/,"rendering use")).replace(/atlas sprite .*/,"atlas sprites"),e[n]=e[n]||0,e[n]++})),e)console.log("   "+(e[t]+"       ").substr(0,7)+t)};var ft=()=>{},dt=function(){},pt=n(2034),vt=n(8010);class mt{constructor(e,t,n,r,i,o,s){this.aabb=new pt(e.base,e.vec),this.mass=t,this.friction=n,this.restitution=r,this.gravityMultiplier=i,this.onCollide=o,this.autoStep=!!s,this.airDrag=-1,this.fluidDrag=-1,this.onStep=null,this.velocity=vt.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=vt.create(),this._impulses=vt.create(),this._sleepFrameCount=10}setPosition(e){gt(e),vt.subtract(e,e,this.aabb.base),this.aabb.translate(e),this._markActive()}getPosition(){return vt.clone(this.aabb.base)}applyForce(e){gt(e),vt.add(this._forces,this._forces,e),this._markActive()}applyImpulse(e){gt(e),vt.add(this._impulses,this._impulses,e),this._markActive()}_markActive(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var gt=e=>{},yt=n(2034),_t=n(8010),bt=n(7504);function kt(){this.airDrag=.1,this.fluidDrag=.4,this.fluidDensity=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function wt(e,t,n){e=Object.assign(new kt,e),this.gravity=e.gravity||[0,-10,0],this.airDrag=e.airDrag||.1,this.fluidDensity=e.fluidDensity||2,this.fluidDrag=e.fluidDrag||.4,this.minBounceImpulse=e.minBounceImpulse,this.bodies=[],this.testSolid=t,this.testFluid=n}wt.prototype.addBody=function(e,t,n,r,i,o){e=e||new yt([0,0,0],[1,1,1]),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=0),void 0===i&&(i=1);var s=new mt(e,t,n,r,i,o);return this.bodies.push(s),s},wt.prototype.removeBody=function(e){var t=this.bodies.indexOf(e);t<0||(this.bodies.splice(t,1),e.aabb=e.onCollide=null)};var xt=_t.create(),Mt=_t.create(),Ct=_t.create(),Pt=_t.create(),It=_t.create();wt.prototype.tick=function(e){e/=1e3;var t=Bt(0,_t.squaredLength(this.gravity));this.bodies.forEach((n=>function(e,t,n,r){if(_t.copy(It,t.resting),t.mass<=0)return _t.set(t.velocity,0,0,0),_t.set(t._forces,0,0,0),void _t.set(t._impulses,0,0,0);if(!function(e,t,n,r){if(t._sleepFrameCount>0)return!1;if(r)return!0;var i=!1,o=.5*n*n*t.gravityMultiplier;return _t.scale(Ft,e.gravity,o),bt(e.testSolid,t.aabb,Ft,(function(){return i=!0,!0}),!0),i}(e,t,n,r||0===t.gravityMultiplier)){t._sleepFrameCount--,function(e,t){var n=t.aabb,r=Math.floor(n.base[0]),i=Math.floor(n.base[2]),o=Math.floor(n.base[1]),s=Math.floor(n.max[1]);if(!e.testFluid(r,o,i))return t.inFluid=!1,void(t.ratioInFluid=0);for(var a=1,u=o+1;u<=s&&e.testFluid(r,u,i);)a++,u++;var c=(o+a-n.base[1])/n.vec[1];c>1&&(c=1);var h=n.vec[0]*n.vec[1]*n.vec[2]*c,l=Dt;_t.scale(l,e.gravity,-e.fluidDensity*h),t.applyForce(l),t.inFluid=!0,t.ratioInFluid=c}(e,t),Ut(t._forces),Ut(t._impulses),Ut(t.velocity),Ut(t.resting),_t.scale(xt,t._forces,1/t.mass),_t.scaleAndAdd(xt,xt,e.gravity,t.gravityMultiplier),_t.scale(Mt,t._impulses,1/t.mass),_t.scaleAndAdd(Mt,Mt,xt,n),_t.add(t.velocity,t.velocity,Mt),t.friction&&(Tt(0,t,Mt),Tt(1,t,Mt),Tt(2,t,Mt));var i=t.airDrag>=0?t.airDrag:e.airDrag;t.inFluid&&(i=t.fluidDrag>=0?t.fluidDrag:e.fluidDrag,i*=1-(1-t.ratioInFluid)**2);var o=Math.max(1-i*n/t.mass,0);_t.scale(t.velocity,t.velocity,o),_t.scale(Ct,t.velocity,n),_t.set(t._forces,0,0,0),_t.set(t._impulses,0,0,0),t.autoStep&&zt(Et,t.aabb),At(e,t.aabb,Ct,t.resting),t.autoStep&&function(e,t,n,r){if(!(t.resting[1]>=0)||t.inFluid){var i=0!==t.resting[0],o=0!==t.resting[2];if(i||o){var s=Math.abs(r[0]/r[2]);if((i||!(s>4))&&(o||!(s<1/4))){_t.add(jt,n.base,r);var a=e.testSolid;bt(a,n,r,(function(e,t,n,r){if(1!==t)return!0;r[t]=0}));var u=t.aabb.base[1],c=Math.floor(u+1.001)-u;_t.set(Rt,0,c,0);var h=!1;bt(a,n,Rt,(function(e,t,n,r){return h=!0,!0})),h||(_t.subtract(Ot,jt,n.base),Ot[1]=0,At(e,n,Ot,St),(!i||Bt(n.base[0],jt[0]))&&(o&&!Bt(n.base[2],jt[2])||(zt(t.aabb,n),t.resting[0]=St[0],t.resting[2]=St[2],t.onStep&&t.onStep())))}}}}(e,t,Et,Ct);for(var s=0;s<3;++s)Pt[s]=0,t.resting[s]&&(It[s]||(Pt[s]=-t.velocity[s]),t.velocity[s]=0);var a=_t.length(Pt);a>.001&&(_t.scale(Pt,Pt,t.mass),t.onCollide&&t.onCollide(Pt),t.restitution>0&&a>e.minBounceImpulse&&(_t.scale(Pt,Pt,t.restitution),t.applyImpulse(Pt))),_t.squaredLength(t.velocity)>1e-5&&t._markActive()}}(this,n,e,t)))};var Dt=_t.create();function Tt(e,t,n){var r=t.resting[e],i=n[e];if(0!==r&&!(r*i<=0)){_t.copy(Lt,t.velocity),Lt[e]=0;var o=_t.length(Lt);if(!Bt(o,0)){var s=Math.abs(t.friction*i),a=o>s?(o-s)/o:0;t.velocity[(e+1)%3]*=a,t.velocity[(e+2)%3]*=a}}}var Lt=_t.create();function At(e,t,n,r){return _t.set(r,0,0,0),bt(e.testSolid,t,n,(function(e,t,n,i){r[t]=n,i[t]=0}))}var Et=new yt([],[]),St=_t.create(),jt=_t.create(),Rt=_t.create(),Ot=_t.create(),Ft=_t.create();function Bt(e,t){return Math.abs(e-t)<1e-5}function zt(e,t){for(var n=0;n<3;n++)e.base[n]=t.base[n],e.max[n]=t.max[n],e.vec[n]=t.vec[n]}var Ut=function(e){},Nt={gravity:[0,-10,0],airDrag:.1};class Vt extends wt{constructor(e,t){t=Object.assign({},Nt,t);var n=e.world,r=e.registry._solidityLookup,i=e.registry._fluidityLookup,o=e.worldOriginOffset;super(t,((e,t,i)=>{var s=n.getBlockID(e+o[0],t+o[1],i+o[2]);return r[s]}),((e,t,r)=>{var s=n.getBlockID(e+o[0],t+o[1],r+o[2]);return i[s]}))}}var qt=n(1920);const Ht=Kt;function Kt(e,t,n,r,i,o,s,a){this.noa=e,this.isDisposed=!1,this.requestID=t,this.voxels=s,this.i=n,this.j=r,this.k=i,this.size=o,this.x=n*o,this.y=r*o,this.z=i*o,this.pos=[this.x,this.y,this.z],this._terrainDirty=!1,this._objectsDirty=!1,this._terrainMeshes=[],e._terrainMesher.initChunk(this),e._objectMesher.initChunk(this),this._isFull=!1,this._isEmpty=!1,this._filledWithVoxel=-1,a>=0&&(this.voxels.data.fill(a,0,this.voxels.size),this._filledWithVoxel=a);var u=Array.from(Array(27),(()=>null));this._neighbors=qt(u,[3,3,3]).lo(1,1,1),this._neighbors.set(0,0,0,this),this._neighborCount=0,this._timesMeshed=0,this._blockHandlerLocs=new Ce.l3,Wt(this)}function Gt(e,t,n,r,i,o){var s=t[n];s&&s(e.x+r,e.y+i,e.z+o)}function Wt(e){var t=e.voxels,n=t.data,r=t.shape[0],i=e.noa.registry._opacityLookup,o=e.noa.registry._blockHandlerLookup,s=e.noa.registry._objectLookup,a=e.noa.registry._blockIsPlainLookup,u=e.noa._objectMesher,c=e._filledWithVoxel;if(c>=0&&!u[c]&&!o[c])return e._isFull=!!i[c],e._isEmpty=0===c,void(e._terrainDirty=!e._isEmpty);for(var h=!0,l=!0,f=0;f<r;++f)for(var d=0;d<r;++d)for(var p=t.index(f,d,0),v=0;v<r;++v,++p){var m=n[p];if(0!==m)if(a[m])l=!1;else{h=h&&i[m],l=!1,s[m]&&(u.setObjectBlock(e,m,f,d,v),e._objectsDirty=!0);var g=o[m];g&&(e._blockHandlerLocs.add(f,d,v),Gt(e,g,"onLoad",f,d,v))}else h=!1}e._isFull=h,e._isEmpty=l,e._terrainDirty=!e._isEmpty}function Zt(e,t){var n=e.voxels,r=e.noa.registry._blockHandlerLookup;e._blockHandlerLocs.arr.forEach((([i,o,s])=>{var a=n.get(i,o,s);Gt(e,r[a],t,i,o,s)}))}Kt._createVoxelArray=function(e){var t=new Uint16Array(e*e*e);return qt(t,[e,e,e])},Kt.prototype._updateVoxelArray=function(e,t){Zt(this,"onUnload"),this.noa._objectMesher.disposeChunk(this),this.noa._terrainMesher.disposeChunk(this),this.voxels=e,this._terrainDirty=!1,this._objectsDirty=!1,this._blockHandlerLocs.empty(),this.noa._objectMesher.initChunk(this),this.noa._terrainMesher.initChunk(this),this._filledWithVoxel=-1,t>=0&&(this._filledWithVoxel=t,this.voxels.data.fill(t,0,this.voxels.size)),Wt(this)},Kt.prototype.get=function(e,t,n){return this.voxels.get(e,t,n)},Kt.prototype.getSolidityAt=function(e,t,n){return this.noa.registry._solidityLookup[this.voxels.get(e,t,n)]},Kt.prototype.set=function(e,t,n,r){var i=this.voxels.get(e,t,n);if(r!==i){this.voxels.set(e,t,n,r);var o=this.noa.registry._solidityLookup,s=this.noa.registry._objectLookup,a=this.noa.registry._opacityLookup,u=this.noa.registry._blockHandlerLookup,c=u[i],h=u[r];c&&Gt(this,c,"onUnset",e,t,n),h?(Gt(this,h,"onSet",e,t,n),this._blockHandlerLocs.add(e,t,n)):this._blockHandlerLocs.remove(e,t,n);var l=this.noa._objectMesher,f=s[i],d=s[r];f&&l.setObjectBlock(this,0,e,t,n),d&&l.setObjectBlock(this,r,e,t,n),a[r]||(this._isFull=!1),0!==r&&(this._isEmpty=!1),this._filledWithVoxel=-1;var p=o[i]!==o[r],v=a[i]!==a[r],m=!f&&0!==i,g=!d&&0!==r;if((f||d)&&(this._objectsDirty=!0),(p||v||m||g)&&(this._terrainDirty=!0),(this._terrainDirty||this._objectsDirty)&&this.noa.world._queueChunkForRemesh(this),p||v)for(var y=this.size-1,_=0===t?-1:0,b=0===n?-1:0,k=e===y?1:0,w=t===y?1:0,x=n===y?1:0,M=0===e?-1:0;M<=k;M++)for(var C=_;C<=w;C++)for(var P=b;P<=x;P++)if(0!=(M|C|P)){var I=this._neighbors.get(M,C,P);I&&(I._terrainDirty=!0,this.noa.world._queueChunkForRemesh(I))}}},Kt.prototype.updateMeshes=function(){this._terrainDirty&&(this.noa._terrainMesher.meshChunk(this),this._timesMeshed++,this._terrainDirty=!1),this._objectsDirty&&(this.noa._objectMesher.buildObjectMeshes(),this._objectsDirty=!1)},Kt.prototype.dispose=function(){Zt(this,"onUnload"),this._blockHandlerLocs.empty(),this.noa._objectMesher.disposeChunk(this),this.noa._terrainMesher.disposeChunk(this),this.voxels.data=null,this.voxels=null,this._neighbors.data=null,this._neighbors=null,this.isDisposed=!0};var Yt={chunkSize:24,chunkAddDistance:[2,2],chunkRemoveDistance:[3,3],worldGenWhilePaused:!1,manuallyControlChunkLoading:!1};class Xt extends(u()){constructor(e,t){var n;super(),t=Object.assign({},Yt,t),this.noa=e,this.playerChunkLoaded=!1,this.Chunk=Ht,this.manuallyControlChunkLoading=!!t.manuallyControlChunkLoading,this.chunkSortingDistFn=fn,this.minNeighborsToMesh=6,this.worldGenWhilePaused=!!t.worldGenWhilePaused,this.maxChunksPendingCreation=10,this.maxChunksPendingMeshing=10,this.maxProcessingPerTick=9,this.maxProcessingPerRender=5,this._chunkSize=t.chunkSize,this._chunkAddDistance=[2,2],this._chunkRemoveDistance=[3,3],this._addDistanceFn=null,this._remDistanceFn=null,this._prevWorldName="",this._prevPlayerChunkHash=0,this._chunkAddSearchFrom=0,this._prevSortingFn=null,this._chunksKnown=null,this._chunksPending=null,this._chunksToRequest=null,this._chunksToRemove=null,this._chunksToMesh=null,this._chunksToMeshFirst=null,this._chunksSortedLocs=null,(n=this)._chunksKnown=new Ce.l3,n._chunksToMesh=new Ce.l3,n._chunksPending=new Ce.l3,n._chunksToRemove=new Ce.l3,n._chunksToRequest=new Ce.l3,n._chunksToMeshFirst=new Ce.l3,n._chunksSortedLocs=new Ce.l3,this.setAddRemoveDistance(t.chunkAddDistance,t.chunkRemoveDistance),this._storage=new Ce.dM;var r=this._chunkSize;this._coordsToChunkIndexes=an,this._coordsToChunkLocals=un,0==(r&r-1)&&(this._coordShiftBits=0|Math.log2(r),this._coordMask=r-1|0,this._coordsToChunkIndexes=cn,this._coordsToChunkLocals=hn)}}Xt.prototype.getBlockID=function(e,t,n){var[r,i,o]=this._coordsToChunkIndexes(e,t,n),s=this._storage.getChunkByIndexes(r,i,o);if(!s)return 0;var[a,u,c]=this._coordsToChunkLocals(e,t,n);return s.voxels.get(a,u,c)},Xt.prototype.getBlockSolidity=function(e,t,n){var[r,i,o]=this._coordsToChunkIndexes(e,t,n),s=this._storage.getChunkByIndexes(r,i,o);if(!s)return!1;var[a,u,c]=this._coordsToChunkLocals(e,t,n);return!!s.getSolidityAt(a,u,c)},Xt.prototype.getBlockOpacity=function(e,t,n){var r=this.getBlockID(e,t,n);return this.noa.registry.getBlockOpacity(r)},Xt.prototype.getBlockFluidity=function(e,t,n){var r=this.getBlockID(e,t,n);return this.noa.registry.getBlockFluidity(r)},Xt.prototype.getBlockProperties=function(e,t,n){var r=this.getBlockID(e,t,n);return this.noa.registry.getBlockProps(r)},Xt.prototype.setBlockID=function(e,t,n,r){var[i,o,s]=this._coordsToChunkIndexes(t,n,r),a=this._storage.getChunkByIndexes(i,o,s);if(a){var[u,c,h]=this._coordsToChunkLocals(t,n,r);return a.set(u,c,h,e,t,n,r)}},Xt.prototype.isBoxUnobstructed=function(e){for(var t=e.base,n=e.max,r=Math.floor(t[0]);r<n[0]+1;r++)for(var i=Math.floor(t[1]);i<n[1]+1;i++)for(var o=Math.floor(t[2]);o<n[2]+1;o++)if(this.getBlockSolidity(r,i,o))return!1;return!0},Xt.prototype.setChunkData=function(e,t,n=null,r=-1){!function(e,t,n,r,i){var o=t.split("|"),s=parseInt(o.shift()),a=parseInt(o.shift()),u=parseInt(o.shift()),c=o.join("|");if(e._chunksPending.remove(s,a,u),c===e.noa.worldName&&e._chunksKnown.includes(s,a,u)&&!e._chunksToRemove.includes(s,a,u)){var h=e._storage.getChunkByIndexes(s,a,u);if(h)h._updateVoxelArray(n,i);else{var l=e._chunkSize;h=new Ht(e.noa,t,s,a,u,l,n,i),e._storage.storeChunkByIndexes(s,a,u,h),h.userData=r,e.noa.rendering.prepareChunkForRendering(h),e.emit("chunkAdded",h)}sn(e,h),dn(e,s,a,u,h),gn("receive")}}(this,e,t,n,r)},Xt.prototype.setAddRemoveDistance=function(e=2,t=3){var n=Array.isArray(e)?e:[e,e],r=Array.isArray(t)?t:[t,t];r[0]<n[0]+1&&(r[0]=n[0]+1),r[1]<n[1]+1&&(r[1]=n[1]+1),this._chunkAddDistance=n,this._chunkRemoveDistance=r,this._addDistanceFn=pn(n[0],n[1]),this._remDistanceFn=pn(r[0],r[1]),this._chunksSortedLocs.empty();for(var i=0;i<=n[0];i++)for(var o=0;o<=i;o++)for(var s=0;s<=n[1];s++)this._addDistanceFn(i,s,o)&&this._chunksSortedLocs.add(i,s,o);this._prevSortingFn=null,this._chunkAddSearchFrom=0},Xt.prototype.invalidateVoxelsInAABB=function(e){!function(e,t){for(var n=e._coordsToChunkIndexes(t.base[0],t.base[1],t.base[2]),r=e._coordsToChunkIndexes(t.max[0],t.max[1],t.max[2]),i=0;i<3;i++)Number.isFinite(t.base[i])||(n[i]=t.base[i]),Number.isFinite(t.max[i])||(r[i]=t.max[i]);e._chunksKnown.forEach((t=>{for(var i=0;i<3;i++)if(t[i]<n[i]||t[i]>=r[i])return;e._chunksToRemove.add(t[0],t[1],t[2]),e._chunksToMesh.remove(t[0],t[1],t[2]),e._chunksToRequest.remove(t[0],t[1],t[2]),e._chunksToMeshFirst.remove(t[0],t[1],t[2])}))}(this,e)},Xt.prototype.manuallyLoadChunk=function(e,t,n){if(!this.manuallyControlChunkLoading)throw $t;var[r,i,o]=this._coordsToChunkIndexes(e,t,n);this._chunksKnown.add(r,i,o),this._chunksToRequest.add(r,i,o)},Xt.prototype.manuallyUnloadChunk=function(e,t,n){if(!this.manuallyControlChunkLoading)throw $t;var[r,i,o]=this._coordsToChunkIndexes(e,t,n);this._chunksToRemove.add(r,i,o),this._chunksToMesh.remove(r,i,o),this._chunksToRequest.remove(r,i,o),this._chunksToMeshFirst.remove(r,i,o)};var $t="Set `noa.world.manuallyControlChunkLoading` if you need this API";function Qt(e){var[t,n,r]=e.noa.entities.getPosition(e.noa.playerEntity);return e._coordsToChunkIndexes(t,n,r)}Xt.prototype.tick=function(){var e=performance.now(),[t,n,r]=Qt(this),i=(0,Ce.wX)(t,n,r),o=i!==this._prevPlayerChunkHash;o&&(this.emit("playerEnteredChunk",t,n,r),this._prevPlayerChunkHash=i,this._chunkAddSearchFrom=0),this._prevWorldName!==this.noa.worldName&&(function(e){e._chunksToRemove.copyFrom(e._chunksKnown),e._chunksToRequest.empty(),e._chunksToMesh.empty(),e._chunksToMeshFirst.empty();var[t,n,r]=Qt(e);ln(e._chunksToRemove,t,n,r,e.chunkSortingDistFn)}(this),this._prevWorldName=this.noa.worldName,this._chunkAddSearchFrom=0,rn(this)),mn("start"),gn("start"),this.manuallyControlChunkLoading||(o&&(function(e,t,n,r){var i=e._remDistanceFn,o=e._chunksToRemove;e._chunksKnown.forEach((([s,a,u])=>{o.includes(s,a,u)||i(s-t,a-n,u-r)||(e._chunksToRemove.add(s,a,u),e._chunksToMesh.remove(s,a,u),e._chunksToRequest.remove(s,a,u),e._chunksToMeshFirst.remove(s,a,u))})),ln(o,t,n,r,e.chunkSortingDistFn)}(this,t,n,r),mn("remQueue")),function(e,t,n,r){var i=e._chunksToRequest,o=e._chunkAddSearchFrom,s=e._chunksSortedLocs;if(!(o>=s.arr.length||e._chunksToRequest.count()>50)){e._prevSortingFn!==e.chunkSortingDistFn&&(e.chunkSortingDistFn||(e.chunkSortingDistFn=fn),ln(s,0,0,0,e.chunkSortingDistFn,!0),e._prevSortingFn=e.chunkSortingDistFn),Jt.removals=0,Jt.ci=t,Jt.cj=n,Jt.ck=r;for(var a=e._chunksSortedLocs.arr,u=o;u<a.length;u++){var[c,h,l]=a[u];if(en(e,Jt,c,h,l),0===Jt.removals){if(e._chunkAddSearchFrom=u+1,i.count()>100)break;if(u-o>50)break}else{if(i.count()>50)break;if(u-o>5)break}}ln(i,t,n,r,e.chunkSortingDistFn)}}(this,t,n,r),mn("addQueue"));var s=Math.max(1,this.maxProcessingPerTick||0),a=!1,u=!1,c=!1;(0,Ce.KV)(s,(()=>(a||(a=function(e){var t=e._chunksToRequest;if(t.isEmpty())return!0;var n=e._chunksPending.count(),r=e._chunksToMesh.count();if(n>=e.maxChunksPendingCreation)return!0;if(r>=e.maxChunksPendingMeshing)return!0;var[i,o,s]=t.pop();return function(e,t,n,r){var i=e._chunkSize,o=Ht._createVoxelArray(e._chunkSize),s=e.noa.worldName,a=[t,n,r,s].join("|"),u=t*i,c=n*i,h=r*i;e._chunksPending.add(t,n,r),e.emit("worldDataNeeded",a,o,u,c,h,s),gn("request")}(e,i,o,s),t.isEmpty()}(this)),mn("requests"),u||(u=on(this,!1)),mn("meshes"),c||(c=rn(this)||rn(this)||rn(this),mn("removes")),a&&u&&c)),e),(s-=performance.now()-e)>.5&&(function(e){var t=e._chunksToMesh.count()+e._chunksToMeshFirst.count();if(!(t>5))for(var n=e._chunksKnown.arr,r=Math.min(50,n.length),i=0;i<r;i++){nn=(nn+1)%n.length;var[o,s,a]=n[nn],u=e._storage.getChunkByIndexes(o,s,a);if(u&&(sn(e,u)&&t++,t>5))return}}(this),mn("looking"),(0,Ce.KV)(s,(()=>on(this,!1)),e),mn("meshes"));var h=this._storage.getChunkByIndexes(t,n,r);this.playerChunkLoaded=!!h,gn("end",this),mn("end")},Xt.prototype.render=function(){var e=this.maxProcessingPerRender;e>0&&(0,Ce.KV)(e,(()=>on(this,!0)))},Xt.prototype._getChunkByCoords=function(e,t,n){var[r,i,o]=this._coordsToChunkIndexes(e,t,n);return this._storage.getChunkByIndexes(r,i,o)},Xt.prototype._queueChunkForRemesh=function(e){sn(this,e)};var Jt={},en=(e,t,n,r,i)=>{tn(e,t,t.ci+n,t.cj+r,t.ck+i),n!==i&&tn(e,t,t.ci+i,t.cj+r,t.ck+n),n>0&&en(e,t,-n,r,i),r>0&&en(e,t,n,-r,i),i>0&&en(e,t,n,r,-i)},tn=(e,t,n,r,i)=>{e._chunksKnown.includes(n,r,i)?e._chunksToRemove.includes(n,r,i)&&t.removals++:(e._chunksKnown.add(n,r,i),e._chunksToRequest.addToFront(n,r,i))},nn=-1;function rn(e){var t=e._chunksToRemove;if(t.isEmpty())return!0;var[n,r,i]=t.pop();return function(e,t,n,r){var i=e._storage.getChunkByIndexes(t,n,r);i&&(e.emit("chunkBeingRemoved",i.requestID,i.voxels,i.userData),e.noa.rendering.disposeChunkForRendering(i),i.dispose(),gn("dispose"),dn(e,t,n,r,null)),e._storage.removeChunkByIndexes(t,n,r),e._chunksKnown.remove(t,n,r),e._chunksToMesh.remove(t,n,r),e._chunksToMeshFirst.remove(t,n,r)}(e,n,r,i),t.isEmpty()}function on(e,t){var n=e._chunksToMeshFirst;if(n.isEmpty()&&!t&&(n=e._chunksToMesh),n.isEmpty())return!0;var[r,i,o]=n.pop();if(!e._chunksToRemove.includes(r,i,o)){var s=e._storage.getChunkByIndexes(r,i,o);s&&function(e,t){e._chunksToMesh.remove(t.i,t.j,t.k),e._chunksToMeshFirst.remove(t.i,t.j,t.k),t.updateMeshes(),gn("mesh")}(e,s)}}function sn(e,t){return!(!t._terrainDirty&&!t._objectsDirty||t._neighborCount<t.minNeighborsToMesh||e._chunksToMesh.includes(t.i,t.j,t.k)||e._chunksToMeshFirst.includes(t.i,t.j,t.k)||((26===t._neighborCount?e._chunksToMeshFirst:e._chunksToMesh).add(t.i,t.j,t.k),0))}function an(e,t,n){var r=this._chunkSize;return[0|Math.floor(e/r),0|Math.floor(t/r),0|Math.floor(n/r)]}function un(e,t,n){var r=this._chunkSize,i=e%r|0;i<0&&(i+=r);var o=t%r|0;o<0&&(o+=r);var s=n%r|0;return s<0&&(s+=r),[i,o,s]}function cn(e,t,n){var r=this._coordShiftBits;return[e>>r|0,t>>r|0,n>>r|0]}function hn(e,t,n){var r=this._coordMask;return[e&r|0,t&r|0,n&r|0]}function ln(e,t,n,r,i,o=!1){o?e.sortByDistance(((e,o,s)=>-i(t-e,n-o,r-s))):e.sortByDistance(((e,o,s)=>i(t-e,n-o,r-s)))}var fn=(e,t,n)=>e*e+t*t+n*n;function dn(e,t,n,r,i){for(var o=!i||i&&!i.isEmpty,s=-1;s<=1;s++)for(var a=-1;a<=1;a++)for(var u=-1;u<=1;u++)if(0!=(s|a|u)){var c=e._storage.getChunkByIndexes(t+s,n+a,r+u);if(c){o&&(c._terrainDirty=!0),i&&!i._neighbors.get(s,a,u)&&(i._neighborCount++,i._neighbors.set(s,a,u,c));var h=c._neighbors.get(-s,-a,-u);i&&!h&&(c._neighborCount++,c._neighbors.set(-s,-a,-u,i),26===c._neighborCount&&sn(e,c)),!i&&h&&(c._neighborCount--,c._neighbors.set(-s,-a,-u,null))}}}function pn(e,t){var n=e*e,r=t*t;return e===t?(e,t,r)=>e*e+t*t+r*r<=n:e>t?(e,r,i)=>!(Math.abs(r)>t)&&e*e+r*r+i*i<=n:(e,t,i)=>{var o=e*e+i*i;return!(o>n)&&o+t*t<=r}}function vn(e,t,n,r){var i=0,o=0,s=0,a=0,u=[];n.forEach((t=>{var n=e._storage.getChunkByIndexes(t[0],t[1],t[2]);n&&(s++,u.push(n._timesMeshed),n._isFull&&i++,n._isEmpty&&o++,26===n._neighborCount&&a++)}));var c=n.length.toString().padEnd(8);if(c+=("exist: "+s).padEnd(12),c+=("full: "+i).padEnd(12),c+=("empty: "+o).padEnd(12),c+=("surr: "+a).padEnd(12),r){var h=u.reduce(((e,t)=>e+t),0),l=u.reduce(((e,t)=>Math.max(e,t)),0),f=u.reduce(((e,t)=>Math.min(e,t)),0);c+="times meshed: avg "+(h/s).toFixed(2),c+="  max "+l,c+="  min "+f}console.log(t,c)}Xt.prototype.report=function(){console.log("World report - playerChunkLoaded: ",this.playerChunkLoaded),vn(this,"  known:     ",this._chunksKnown.arr,!0),vn(this,"  to request:",this._chunksToRequest.arr,0),vn(this,"  to remove: ",this._chunksToRemove.arr,0),vn(this,"  creating:  ",this._chunksPending.arr,0),vn(this,"  to mesh:   ",this._chunksToMesh.arr.concat(this._chunksToMeshFirst.arr),0)};var mn=(0,Ce.hv)(0,"world ticks:",1),gn=()=>{},yn={debug:!1,silent:!1,silentBabylon:!1,playerHeight:1.8,playerWidth:.6,playerStart:[0,10,0],playerAutoStep:!1,tickRate:30,maxRenderRate:0,blockTestDistance:10,stickyPointerLock:!0,dragCameraOutsidePointerLock:!0,stickyFullscreen:!1,skipDefaultHighlighting:!1,originRebaseDistance:25};class _n extends a.EventEmitter{constructor(e={}){if(super(),e=Object.assign({},yn,e),this.version="0.33.0",!e.silent){var t=e.debug?" (debug)":"";console.log(`noa-engine v${this.version}${t}`)}this._paused=!1,this._dragOutsideLock=e.dragCameraOutsidePointerLock,this._originRebaseDistance=e.originRebaseDistance,this.worldOriginOffset=[0,0,0],this.positionInCurrentTick=0,this.worldName="default",this.timeScale=1,this.container=new L(this,e),this.tickRate=this.container._shell.tickRate,Object.defineProperty(this,"tickRate",{get:()=>this.container._shell.tickRate}),this.maxRenderRate=this.container._shell.maxRenderRate,Object.defineProperty(this,"maxRenderRate",{get:()=>this.container._shell.maxRenderRate,set:e=>{this.container._shell.maxRenderRate=e||0}}),this.inputs=new C(this,e,this.container.element),this.registry=new Ge(this,e),this.world=new Xt(this,e);var n=console.log;e.silentBabylon&&(console.log=()=>{}),this.rendering=new ht(this,e,this.container.canvas),e.silentBabylon&&(console.log=n),this.physics=new Vt(this,e),this.entities=new we(this,e),this.ents=this.entities;var r=this.entities;this.playerEntity=r.add(e.playerStart,e.playerWidth,e.playerHeight,null,null,!0,!0),r.addComponent(this.playerEntity,r.names.collideTerrain),r.addComponent(this.playerEntity,r.names.collideEntities);var o=r.getPhysics(this.playerEntity).body;if(o.gravityMultiplier=2,o.autoStep=e.playerAutoStep,r.addComponent(this.playerEntity,r.names.receivesInputs),r.addComponent(this.playerEntity,r.names.fadeOnZoom),r.addComponent(this.playerEntity,r.names.movement,{airJumps:1}),this.camera=new B(this,e),this.blockTestDistance=e.blockTestDistance,this.blockTargetIdCheck=this.registry.getBlockSolidity,this.targetedBlock=null,e.skipDefaultHighlighting||(this.defaultBlockHighlightFunction=e=>{e?this.rendering.highlightBlockFace(!0,e.position,e.normal):this.rendering.highlightBlockFace(!1)},this.on("targetBlockChanged",this.defaultBlockHighlightFunction)),this._terrainMesher=new Fe(this),this._objectMesher=new Ie(this),this._targetedBlockDat={blockID:0,position:i().create(),normal:i().create(),adjacent:i().create()},this._prevTargetHash=0,this.makeTargetHash=(e,t,n)=>(0,Ce.wX)(e[0]+n,e[1],e[2])^(0,Ce.wX)(t[0],t[1]+n,t[2]),this._pickPos=i().create(),this._pickResult={_localPosition:i().create(),position:[0,0,0],normal:[0,0,0]},e.debug){this.vec3=i(),this.ndarray=s(),r.getMovement(1).airJumps=999;var a=window;a.noa=this,a.vec3=i(),a.ndarray=s(),a.scene=this.rendering._scene}!function(e){var t="0.27",n=(e,n,r)=>{var i=()=>{throw`This property changed in ${t} - ${r}`};Object.defineProperty(e,n,{get:i,set:i})};n(e,"getPlayerEyePosition","to get the camera/player offset see API docs for `noa.camera.cameraTarget`"),n(e,"setPlayerEyePosition","to set the camera/player offset see API docs for `noa.camera.cameraTarget`"),n(e,"getPlayerPosition","use `noa.ents.getPosition(noa.playerEntity)` or similar"),n(e,"getCameraVector","use `noa.camera.getDirection`"),n(e,"getPlayerMesh","use `noa.ents.getMeshData(noa.playerEntity).mesh` or similar"),n(e,"playerBody","use `noa.ents.getPhysicsBody(noa.playerEntity)`"),n(e.rendering,"zoomDistance","use `noa.camera.zoomDistance`"),n(e.rendering,"_currentZoom","use `noa.camera.currentZoom`"),n(e.rendering,"_cameraZoomSpeed","use `noa.camera.zoomSpeed`"),n(e.rendering,"getCameraVector","use `noa.camera.getDirection`"),n(e.rendering,"getCameraPosition","use `noa.camera.getLocalPosition`"),n(e.rendering,"getCameraRotation","use `noa.camera.heading` and `noa.camera.pitch`"),n(e.rendering,"setCameraRotation","to customize camera behavior see API docs for `noa.camera`"),t="0.28",n(e.rendering,"makeMeshInstance","removed, use Babylon's `mesh.createInstance`"),n(e.world,"_maxChunksPendingCreation",'use `maxChunksPendingCreation` (no "_")'),n(e.world,"_maxChunksPendingMeshing",'use `maxChunksPendingMeshing` (no "_")'),n(e.world,"_maxProcessingPerTick",'use `maxProcessingPerTick` (no "_")'),n(e.world,"_maxProcessingPerRender",'use `maxProcessingPerRender` (no "_")'),t="0.29",n(e,"_constants","removed, voxel IDs are no longer packed with bit flags"),t="0.30",n(e,"_tickRate","tickRate is now at `noa.tickRate`"),n(e.container,"_tickRate","tickRate is now at `noa.tickRate`"),t="0.31",n(e.world,"chunkSize","effectively an internal, so changed to `_chunkSize`"),n(e.world,"chunkAddDistance","set this with `noa.world.setAddRemoveDistance`"),n(e.world,"chunkRemoveDistance","set this with `noa.world.setAddRemoveDistance`")}(this)}tick(e){if(e*=this.timeScale||1,this._paused)this.world.worldGenWhilePaused&&this.world.tick();else if(bn("start"),function(e){var t=e.ents.getPositionData(e.playerEntity)._localPosition,n=e._originRebaseDistance;if(!(i().sqrLen(t)<n*n)){for(var r=[],o=0;o<3;o++)r[o]=Math.floor(t[o]),e.worldOriginOffset[o]+=r[o];e.rendering._rebaseOrigin(r),e.entities._rebaseOrigin(r),e._objectMesher._rebaseOrigin(r)}}(this),this.world.tick(),bn("world"),this.world.playerChunkLoaded){this.physics.tick(e),bn("physics"),this._objectMesher.tick(),this.rendering.tick(e),bn("rendering"),function(e){var t=0,n=e.blockTargetIdCheck||e.registry.getBlockSolidity,r=e._localPick(null,null,null,n);if(r){var o=e._targetedBlockDat;i().floor(o.adjacent,r.position),i().copy(o.normal,r.normal),i().subtract(o.position,o.adjacent,o.normal),o.blockID=e.world.getBlockID(o.position[0],o.position[1],o.position[2]),e.targetedBlock=o,t=e.makeTargetHash(o.position,o.normal,o.blockID,Ce.wX)}else e.targetedBlock=null;t!=e._prevTargetHash&&(e.emit("targetBlockChanged",e.targetedBlock),e._prevTargetHash=t)}(this),bn("targets"),this.entities.tick(e),bn("entities"),this.emit("tick",e),bn("tick event"),bn("end");var t=this.inputs.pointerState;t.scrollx=t.scrolly=t.scrollz=0}else this.rendering.tick(e)}render(e,t){e*=this.timeScale||1,this.positionInCurrentTick=t,this._paused?this.world.worldGenWhilePaused&&this.world.render():(kn("start"),(this.container.hasPointerLock||!this.container.supportsPointerLock||this._dragOutsideLock&&this.inputs.state.fire)&&this.camera.applyInputsToCamera(),kn("init"),this.world.render(),kn("meshing"),this.camera.updateBeforeEntityRenderSystems(),this.entities.render(e),this.camera.updateAfterEntityRenderSystems(),kn("entities"),this.emit("beforeRender",e),kn("before render"),this.rendering.render(),this.rendering.postRender(),kn("render"),this.emit("afterRender",e),kn("after render"),kn("end"),this.inputs.pointerState.dx=this.inputs.pointerState.dy=0)}setPaused(e=!1){this._paused=!!e,e||(this.inputs.pointerState.dx=this.inputs.pointerState.dy=0)}getBlock(e,t=0,n=0){return e.length?this.world.getBlockID(e[0],e[1],e[2]):this.world.getBlockID(e,t,n)}setBlock(e,t,n=0,r=0){return t.length?this.world.setBlockID(e,t[0],t[1],t[2]):this.world.setBlockID(e,t,n,r)}addBlock(e,t,n=0,r=0){if(t.length){if(this.entities.isTerrainBlocked(t[0],t[1],t[2]))return;return this.world.setBlockID(e,t[0],t[1],t[2]),e}if(!this.entities.isTerrainBlocked(t,n,r))return this.world.setBlockID(e,t,n,r),e}globalToLocal(e,t,n){var r=this.worldOriginOffset;if(t){for(var o=0;o<3;o++){var s=e[o]-r[o];s+=t[o],n[o]=s}return n}return i().subtract(n,e,r)}localToGlobal(e,t,n=null){var r=this.worldOriginOffset;if(n){for(var o=0;o<3;o++){var s=Math.floor(e[o]);t[o]=s+r[o],n[o]=e[o]-s}return t}return i().add(t,e,r)}pick(e=null,t=null,n=-1,r=null){if(0===n)return null;var i=this._pickPos;return e&&(this.globalToLocal(e,null,i),e=i),this._localPick(e,t,n,r)}_localPick(e=null,t=null,n=-1,r=null){if(0===n)return null;var o=r||this.registry.getBlockSolidity,s=this.world,a=this.worldOriginOffset;e||(e=this.camera._localGetTargetPosition()),t=t||this.camera.getDirection(),(n=n||-1)<0&&(n=this.blockTestDistance);var u=this._pickResult,c=u._localPosition,l=u.normal,f=h()((function(e,t,n){var r=s.getBlockID(e+a[0],t+a[1],n+a[2]);return o(r)}),e,t,n,c,l);return f?(i().scaleAndAdd(c,c,l,.01),this.localToGlobal(c,u.position),u):null}}n(202).hv;var bn=()=>{},kn=()=>{},wn=new _n({debug:!0,showFPS:!0,inverseY:!0,chunkSize:48,texturePath:"textures/",chunkAddDistance:[8.5,6],playerStart:[0,10,0],playerAutoStep:!0});wn.registry.registerMaterial("grass",{textureURL:"terrain_atlas.png",atlasIndex:0}),wn.registry.registerMaterial("g_dirt",{textureURL:"terrain_atlas.png",atlasIndex:1}),wn.registry.registerMaterial("dirt",{textureURL:"terrain_atlas.png",atlasIndex:2}),wn.registry.registerMaterial("stone",{textureURL:"terrain_atlas.png",atlasIndex:3}),wn.registry.registerMaterial("stone2",{textureURL:"terrain_atlas.png",atlasIndex:4}),wn.registry.registerMaterial("cloud",{textureURL:"terrain_atlas.png",atlasIndex:5});var xn=1,Mn=wn.registry.registerBlock(xn++,{material:"dirt"}),Cn=wn.registry.registerBlock(xn++,{material:["grass","dirt","g_dirt"]}),Pn=wn.registry.registerBlock(xn++,{material:"stone"}),In=wn.registry.registerBlock(xn++,{material:"stone2"}),Dn=wn.registry.registerBlock(xn++,{material:"cloud"}),Tn=(e,t,n,r,i,o,s)=>t<r?t<-1.8?Pn:t<1.2?Mn:r-t<1?Cn:Mn:t<r+s?In:t>i&&t<o?Dn:0;wn.world.on("worldDataNeeded",((e,t,n,r,i)=>{if(r>40||r<-20){var o=r>0?0:Pn;return wn.world.setChunkData(e,t,null,o)}for(var s=0;s<t.shape[0];s++)for(var a=n+s,u=0;u<t.shape[2];u++){var c=i+u,h=Math.sqrt(a*a+c*c)/100,l=An(a,150),f=An(c+50,140),d=An(a-c-50,120);h+=2*l+f+d;for(var p=Math.random()<.002?5:0,v=29+2*(f-d),m=25+2*(l-f),g=0;g<t.shape[1];g++){var y=Tn(0,r+g,0,h,v,m,p);t.set(s,g,u,y)}}wn.world.setChunkData(e,t)})),wn.inputs.down.on("fire",(function(){if(wn.targetedBlock){var e=wn.targetedBlock.position;wn.setBlock(0,e[0],e[1],e[2])}})),wn.on("tick",(function(e){var t=wn.inputs.pointerState.scrolly;0!==t&&(wn.camera.zoomDistance+=t>0?1:-1,wn.camera.zoomDistance<0&&(wn.camera.zoomDistance=0),wn.camera.zoomDistance>10&&(wn.camera.zoomDistance=10))})),wn.inputs.bind("pause","KeyP"),wn.inputs.down.on("pause",(function(){Ln=!Ln,wn.setPaused(Ln)}));var Ln=!1;function An(e,t){var n=e/t,r=n-Math.floor(n);return Sn[1e3*r|0]}window.setViewDistance=(e=100)=>{e=e<50?50:e>5e3?5e3:e;var t=Math.max(1.5,e/wn.world._chunkSize),n=Math.max(1.5,.5*t);wn.world.setAddRemoveDistance([t,n],[t+1,n+1])};var En=[0,0,0].map(Math.random),Sn=Array.from(Array(1e3)).map(((e,t)=>{var n=Math.cos(2*Math.PI*(t/1e3+En[0]));return(n+=.5*Math.cos(2*Math.PI*(t/500+En[1])))+.25*Math.cos(2*Math.PI*(t/250+En[2]))}))},8072:(e,t,n)=>{"use strict";var r=n(1205),i=n(2820),o=n(712);n.g.__TYPEDARRAY_POOL||(n.g.__TYPEDARRAY_POOL={UINT8:i([32,0]),UINT16:i([32,0]),UINT32:i([32,0]),INT8:i([32,0]),INT16:i([32,0]),INT32:i([32,0]),FLOAT:i([32,0]),DOUBLE:i([32,0]),DATA:i([32,0]),UINT8C:i([32,0]),BUFFER:i([32,0])});var s="undefined"!=typeof Uint8ClampedArray,a=n.g.__TYPEDARRAY_POOL;a.UINT8C||(a.UINT8C=i([32,0])),a.BUFFER||(a.BUFFER=i([32,0]));var u=a.DATA,c=a.BUFFER;function h(e){if(e){var t=e.length||e.byteLength,n=r.log2(t);u[n].push(e)}}function l(e){e=r.nextPow2(e);var t=r.log2(e),n=u[t];return n.length>0?n.pop():new ArrayBuffer(e)}function f(e){return new Uint8Array(l(e),0,e)}function d(e){return new Uint16Array(l(2*e),0,e)}function p(e){return new Uint32Array(l(4*e),0,e)}function v(e){return new Int8Array(l(e),0,e)}function m(e){return new Int16Array(l(2*e),0,e)}function g(e){return new Int32Array(l(4*e),0,e)}function y(e){return new Float32Array(l(4*e),0,e)}function _(e){return new Float64Array(l(8*e),0,e)}function b(e){return s?new Uint8ClampedArray(l(e),0,e):f(e)}function k(e){return new DataView(l(e),0,e)}t.free=function(e){if(o(e))c[r.log2(e.length)].push(e);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(e)&&(e=e.buffer),!e)return;var t=e.length||e.byteLength,n=0|r.log2(t);u[n].push(e)}},t.freeUint8=t.freeUint16=t.freeUint32=t.freeInt8=t.freeInt16=t.freeInt32=t.freeFloat32=t.freeFloat=t.freeFloat64=t.freeDouble=t.freeUint8Clamped=t.freeDataView=function(e){h(e.buffer)},t.freeArrayBuffer=h,t.freeBuffer=function(e){c[r.log2(e.length)].push(e)},t.malloc=function(e,t){if(void 0===t||"arraybuffer"===t)return l(e);switch(t){case"uint8":return f(e);case"uint16":return d(e);case"uint32":return p(e);case"int8":return v(e);case"int16":return m(e);case"int32":return g(e);case"float":case"float32":return y(e);case"double":case"float64":return _(e);case"uint8_clamped":return b(e);case"buffer":throw"Buffer not supported";case"data":case"dataview":return k(e);default:return null}return null},t.mallocArrayBuffer=l,t.mallocUint8=f,t.mallocUint16=d,t.mallocUint32=p,t.mallocInt8=v,t.mallocInt16=m,t.mallocInt32=g,t.mallocFloat32=t.mallocFloat=y,t.mallocFloat64=t.mallocDouble=_,t.mallocUint8Clamped=b,t.mallocDataView=k,t.clearCache=function(){for(var e=0;e<32;++e)a.UINT8[e].length=0,a.UINT16[e].length=0,a.UINT32[e].length=0,a.INT8[e].length=0,a.INT16[e].length=0,a.INT32[e].length=0,a.FLOAT[e].length=0,a.DOUBLE[e].length=0,a.UINT8C[e].length=0,u[e].length=0,c[e].length=0}},2034:(e,t,n)=>{e.exports=i;var r=n(8010);function i(e,t){if(!(this instanceof i))return new i(e,t);var n=r.create();r.add(n,e,t),this.base=r.min(r.create(),e,n),this.vec=r.clone(t),this.max=r.max(r.create(),e,n),this.mag=r.length(this.vec)}var o=i.prototype;o.width=function(){return this.vec[0]},o.height=function(){return this.vec[1]},o.depth=function(){return this.vec[2]},o.x0=function(){return this.base[0]},o.y0=function(){return this.base[1]},o.z0=function(){return this.base[2]},o.x1=function(){return this.max[0]},o.y1=function(){return this.max[1]},o.z1=function(){return this.max[2]},o.translate=function(e){return r.add(this.max,this.max,e),r.add(this.base,this.base,e),this},o.setPosition=function(e){return r.add(this.max,e,this.vec),r.copy(this.base,e),this},o.expand=function(e){var t=r.create(),n=r.create();return r.max(t,e.max,this.max),r.min(n,e.base,this.base),r.subtract(t,t,n),new i(n,t)},o.intersects=function(e){return!(e.base[0]>this.max[0]||e.base[1]>this.max[1]||e.base[2]>this.max[2]||e.max[0]<this.base[0]||e.max[1]<this.base[1]||e.max[2]<this.base[2])},o.touches=function(e){var t=this.union(e);return null!==t&&(0==t.width()||0==t.height()||0==t.depth())},o.union=function(e){if(!this.intersects(e))return null;var t=Math.max(e.base[0],this.base[0]),n=Math.max(e.base[1],this.base[1]),r=Math.max(e.base[2],this.base[2]);return new i([t,n,r],[Math.min(e.max[0],this.max[0])-t,Math.min(e.max[1],this.max[1])-n,Math.min(e.max[2],this.max[2])-r])}},1205:(e,t)=>{"use strict";function n(e){var t=32;return(e&=-e)&&t--,65535&e&&(t-=16),16711935&e&&(t-=8),252645135&e&&(t-=4),858993459&e&&(t-=2),1431655765&e&&(t-=1),t}t.INT_BITS=32,t.INT_MAX=2147483647,t.INT_MIN=-1<<31,t.sign=function(e){return(e>0)-(e<0)},t.abs=function(e){var t=e>>31;return(e^t)-t},t.min=function(e,t){return t^(e^t)&-(e<t)},t.max=function(e,t){return e^(e^t)&-(e<t)},t.isPow2=function(e){return!(e&e-1||!e)},t.log2=function(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1},t.log10=function(e){return e>=1e9?9:e>=1e8?8:e>=1e7?7:e>=1e6?6:e>=1e5?5:e>=1e4?4:e>=1e3?3:e>=100?2:e>=10?1:0},t.popCount=function(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24},t.countTrailingZeros=n,t.nextPow2=function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,1+(e|=e>>>16)},t.prevPow2=function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},t.parity=function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,27030>>>(e&=15)&1};var r=new Array(256);!function(e){for(var t=0;t<256;++t){var n=t,r=t,i=7;for(n>>>=1;n;n>>>=1)r<<=1,r|=1&n,--i;e[t]=r<<i&255}}(r),t.reverse=function(e){return r[255&e]<<24|r[e>>>8&255]<<16|r[e>>>16&255]<<8|r[e>>>24&255]},t.interleave2=function(e,t){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))<<1},t.deinterleave2=function(e,t){return(e=65535&((e=16711935&((e=252645135&((e=858993459&((e=e>>>t&1431655765)|e>>>1))|e>>>2))|e>>>4))|e>>>16))<<16>>16},t.interleave3=function(e,t,n){return e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2),(e|=(t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2))<<1)|(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<2},t.deinterleave3=function(e,t){return(e=1023&((e=4278190335&((e=251719695&((e=3272356035&((e=e>>>t&1227133513)|e>>>2))|e>>>4))|e>>>8))|e>>>16))<<22>>22},t.nextCombination=function(e){var t=e|e-1;return t+1|(~t&-~t)-1>>>n(e)+1}},9535:(e,t,n)=>{"use strict";e.exports=function(e,t,n){switch(arguments.length){case 1:return l(e);case 2:return"function"==typeof t?c(e,e,t,!0):f(e,t);case 3:return c(e,t,n,!1);default:throw new Error("box-intersect: Invalid arguments")}};var r,i=n(8072),o=n(2742),s=n(5577);function a(e,t){for(var n=0;n<e;++n)if(!(t[n]<=t[n+e]))return!0;return!1}function u(e,t,n,r){for(var i=0,o=0,s=0,u=e.length;s<u;++s){var c=e[s];if(!a(t,c)){for(var h=0;h<2*t;++h)n[i++]=c[h];r[o++]=s}}return o}function c(e,t,n,r){var a=e.length,c=t.length;if(!(a<=0||c<=0)){var h=e[0].length>>>1;if(!(h<=0)){var l,f=i.mallocDouble(2*h*a),d=i.mallocInt32(a);if((a=u(e,h,f,d))>0){if(1===h&&r)o.init(a),l=o.sweepComplete(h,n,0,a,f,d,0,a,f,d);else{var p=i.mallocDouble(2*h*c),v=i.mallocInt32(c);(c=u(t,h,p,v))>0&&(o.init(a+c),l=1===h?o.sweepBipartite(h,n,0,a,f,d,0,c,p,v):s(h,n,r,a,f,d,c,p,v),i.free(p),i.free(v))}i.free(f),i.free(d)}return l}}}function h(e,t){r.push([e,t])}function l(e){return r=[],c(e,e,h,!0),r}function f(e,t){return r=[],c(e,t,h,!1),r}},7985:(e,t)=>{"use strict";var n=["d","ax","vv","rs","re","rb","ri","bs","be","bb","bi"];function r(e){var t="bruteForce"+(e?"Full":"Partial"),r=[],i=n.slice();e||i.splice(3,0,"fp");var o=["function "+t+"("+i.join()+"){"];function s(t,i){var s=function(e,t,r){var i="bruteForce"+(e?"Red":"Blue")+(t?"Flip":"")+(r?"Full":""),o=["function ",i,"(",n.join(),"){","var ","es","=2*","d",";"],s="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",a="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(r?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return e?o.push(s,"Q",":",a):o.push(a,"Q",":",s),r?o.push("if(y1<x0||x1<y0)continue;"):t?o.push("if(y0<=x0||x1<y0)continue;"):o.push("if(y0<x0||x1<y0)continue;"),o.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),t?o.push("yi,xi"):o.push("xi,yi"),o.push(");if(rv!==void 0)return rv;}}}"),{name:i,code:o.join("")}}(t,i,e);r.push(s.code),o.push("return "+s.name+"("+n.join()+");")}o.push("if(re-rs>be-bs){"),e?(s(!0,!1),o.push("}else{"),s(!1,!1)):(o.push("if(fp){"),s(!0,!0),o.push("}else{"),s(!0,!1),o.push("}}else{if(fp){"),s(!1,!0),o.push("}else{"),s(!1,!1),o.push("}")),o.push("}}return "+t);var a=r.join("")+o.join("");return new Function(a)()}t.partial=r(!1),t.full=r(!0)},5577:(e,t,n)=>{"use strict";e.exports=function(e,t,n,o,h,w,x,M,C){!function(e,t){var n=8*i.log2(t+1)*(e+1)|0,o=i.nextPow2(6*n);g.length<o&&(r.free(g),g=r.mallocInt32(o));var s=i.nextPow2(2*n);y.length<s&&(r.free(y),y=r.mallocDouble(s))}(e,o+x);var P,I=0,D=2*e;for(_(I++,0,0,o,0,x,n?16:0,-1/0,1/0),n||_(I++,0,0,x,0,o,1,-1/0,1/0);I>0;){var T=6*(I-=1),L=g[T],A=g[T+1],E=g[T+2],S=g[T+3],j=g[T+4],R=g[T+5],O=2*I,F=y[O],B=y[O+1],z=1&R,U=!!(16&R),N=h,V=w,q=M,H=C;if(z&&(N=M,V=C,q=h,H=w),!(2&R&&(E=d(e,L,A,E,N,V,B),A>=E)||4&R&&(A=p(e,L,A,E,N,V,F))>=E)){var K=E-A,G=j-S;if(U){if(e*K*(K+G)<4194304){if(void 0!==(P=u.scanComplete(e,L,t,A,E,N,V,S,j,q,H)))return P;continue}}else{if(e*Math.min(K,G)<128){if(void 0!==(P=s(e,L,t,z,A,E,N,V,S,j,q,H)))return P;continue}if(e*K*G<4194304){if(void 0!==(P=u.scanBipartite(e,L,t,z,A,E,N,V,S,j,q,H)))return P;continue}}var W=l(e,L,A,E,N,V,F,B);if(A<W)if(e*(W-A)<128){if(void 0!==(P=a(e,L+1,t,A,W,N,V,S,j,q,H)))return P}else if(L===e-2){if(void 0!==(P=z?u.sweepBipartite(e,t,S,j,q,H,A,W,N,V):u.sweepBipartite(e,t,A,W,N,V,S,j,q,H)))return P}else _(I++,L+1,A,W,S,j,z,-1/0,1/0),_(I++,L+1,S,j,A,W,1^z,-1/0,1/0);if(W<E){var Z=c(e,L,S,j,q,H),Y=q[D*Z+L],X=f(e,L,Z,j,q,H,Y);if(X<j&&_(I++,L,W,E,X,j,(4|z)+(U?16:0),Y,B),S<Z&&_(I++,L,W,E,S,Z,(2|z)+(U?16:0),F,Y),Z+1===X){if(void 0!==(P=U?k(e,L,t,W,E,N,V,Z,q,H[Z]):b(e,L,t,z,W,E,N,V,Z,q,H[Z])))return P}else if(Z<X){var $;if(U){if(W<($=v(e,L,W,E,N,V,Y))){var Q=f(e,L,W,$,N,V,Y);if(L===e-2){if(W<Q&&void 0!==(P=u.sweepComplete(e,t,W,Q,N,V,Z,X,q,H)))return P;if(Q<$&&void 0!==(P=u.sweepBipartite(e,t,Q,$,N,V,Z,X,q,H)))return P}else W<Q&&_(I++,L+1,W,Q,Z,X,16,-1/0,1/0),Q<$&&(_(I++,L+1,Q,$,Z,X,0,-1/0,1/0),_(I++,L+1,Z,X,Q,$,1,-1/0,1/0))}}else W<($=z?m(e,L,W,E,N,V,Y):v(e,L,W,E,N,V,Y))&&(L===e-2?P=z?u.sweepBipartite(e,t,Z,X,q,H,W,$,N,V):u.sweepBipartite(e,t,W,$,N,V,Z,X,q,H):(_(I++,L+1,W,$,Z,X,z,-1/0,1/0),_(I++,L+1,Z,X,W,$,1^z,-1/0,1/0)))}}}}};var r=n(8072),i=n(1205),o=n(7985),s=o.partial,a=o.full,u=n(2742),c=n(2363),h=n(5808),l=h("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),f=h("lo===p0",["p0"]),d=h("lo<p0",["p0"]),p=h("hi<=p0",["p0"]),v=h("lo<=p0&&p0<=hi",["p0"]),m=h("lo<p0&&p0<=hi",["p0"]),g=r.mallocInt32(1024),y=r.mallocDouble(1024);function _(e,t,n,r,i,o,s,a,u){var c=6*e;g[c]=t,g[c+1]=n,g[c+2]=r,g[c+3]=i,g[c+4]=o,g[c+5]=s;var h=2*e;y[h]=a,y[h+1]=u}function b(e,t,n,r,i,o,s,a,u,c,h){var l=2*e,f=u*l,d=c[f+t];e:for(var p=i,v=i*l;p<o;++p,v+=l){var m=s[v+t],g=s[v+t+e];if(!(d<m||g<d||r&&d===m)){for(var y,_=a[p],b=t+1;b<e;++b){m=s[v+b],g=s[v+b+e];var k=c[f+b],w=c[f+b+e];if(g<k||w<m)continue e}if(void 0!==(y=r?n(h,_):n(_,h)))return y}}}function k(e,t,n,r,i,o,s,a,u,c){var h=2*e,l=a*h,f=u[l+t];e:for(var d=r,p=r*h;d<i;++d,p+=h){var v=s[d];if(v!==c){var m=o[p+t],g=o[p+t+e];if(!(f<m||g<f)){for(var y=t+1;y<e;++y){m=o[p+y],g=o[p+y+e];var _=u[l+y],b=u[l+y+e];if(g<_||b<m)continue e}var k=n(v,c);if(void 0!==k)return k}}}}},2363:(e,t,n)=>{"use strict";e.exports=function(e,t,n,o,s,a){if(o<=n+1)return n;for(var u=n,c=o,h=o+n>>>1,l=2*e,f=h,d=s[l*h+t];u<c;){if(c-u<8){i(e,t,u,c,s,a),d=s[l*h+t];break}var p=c-u,v=Math.random()*p+u|0,m=s[l*v+t],g=Math.random()*p+u|0,y=s[l*g+t],_=Math.random()*p+u|0,b=s[l*_+t];m<=y?b>=y?(f=g,d=y):m>=b?(f=v,d=m):(f=_,d=b):y>=b?(f=g,d=y):b>=m?(f=v,d=m):(f=_,d=b);for(var k=l*(c-1),w=l*f,x=0;x<l;++x,++k,++w){var M=s[k];s[k]=s[w],s[w]=M}var C=a[c-1];for(a[c-1]=a[f],a[f]=C,k=l*(c-1),w=l*(f=r(e,t,u,c-1,s,a,d)),x=0;x<l;++x,++k,++w)M=s[k],s[k]=s[w],s[w]=M;if(C=a[c-1],a[c-1]=a[f],a[f]=C,h<f){for(c=f-1;u<c&&s[l*(c-1)+t]===d;)c-=1;c+=1}else{if(!(f<h))break;for(u=f+1;u<c&&s[l*u+t]===d;)u+=1}}return r(e,t,n,h,s,a,s[l*h+t])};var r=n(5808)("lo<p0",["p0"]);function i(e,t,n,r,i,o){for(var s=2*e,a=s*(n+1)+t,u=n+1;u<r;++u,a+=s)for(var c=i[a],h=u,l=s*(u-1);h>n&&i[l+t]>c;--h,l-=s){for(var f=l,d=l+s,p=0;p<s;++p,++f,++d){var v=i[f];i[f]=i[d],i[d]=v}var m=o[h];o[h]=o[h-1],o[h-1]=m}}},5808:e=>{"use strict";e.exports=function(e,t){var n="abcdef".split("").concat(t),r=[];return e.indexOf("lo")>=0&&r.push("lo=e[k+n]"),e.indexOf("hi")>=0&&r.push("hi=e[k+o]"),n.push("for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m".replace("_",r.join()).replace("$",e)),Function.apply(void 0,n)}},1120:e=>{"use strict";function t(e,t,n){for(var r=2*(e+1),i=e+1;i<=t;++i){for(var o=n[r++],s=n[r++],a=i,u=r-2;a-- >e;){var c=n[u-2],h=n[u-1];if(c<o)break;if(c===o&&h<s)break;n[u]=c,n[u+1]=h,u-=2}n[u]=o,n[u+1]=s}}function n(e,t,n){t*=2;var r=n[e*=2],i=n[e+1];n[e]=n[t],n[e+1]=n[t+1],n[t]=r,n[t+1]=i}function r(e,t,n){t*=2,n[e*=2]=n[t],n[e+1]=n[t+1]}function i(e,t,n,r){t*=2,n*=2;var i=r[e*=2],o=r[e+1];r[e]=r[t],r[e+1]=r[t+1],r[t]=r[n],r[t+1]=r[n+1],r[n]=i,r[n+1]=o}function o(e,t,n,r,i){t*=2,i[e*=2]=i[t],i[t]=n,i[e+1]=i[t+1],i[t+1]=r}function s(e,t,n){t*=2;var r=n[e*=2],i=n[t];return!(r<i)&&(r!==i||n[e+1]>n[t+1])}function a(e,t,n,r){var i=r[e*=2];return i<t||i===t&&r[e+1]<n}function u(e,c,h){var l=(c-e+1)/6|0,f=e+l,d=c-l,p=e+c>>1,v=p-l,m=p+l,g=f,y=v,_=p,b=m,k=d,w=e+1,x=c-1,M=0;s(g,y,h)&&(M=g,g=y,y=M),s(b,k,h)&&(M=b,b=k,k=M),s(g,_,h)&&(M=g,g=_,_=M),s(y,_,h)&&(M=y,y=_,_=M),s(g,b,h)&&(M=g,g=b,b=M),s(_,b,h)&&(M=_,_=b,b=M),s(y,k,h)&&(M=y,y=k,k=M),s(y,_,h)&&(M=y,y=_,_=M),s(b,k,h)&&(M=b,b=k,k=M);for(var C=h[2*y],P=h[2*y+1],I=h[2*b],D=h[2*b+1],T=2*g,L=2*_,A=2*k,E=2*f,S=2*p,j=2*d,R=0;R<2;++R){var O=h[T+R],F=h[L+R],B=h[A+R];h[E+R]=O,h[S+R]=F,h[j+R]=B}r(v,e,h),r(m,c,h);for(var z=w;z<=x;++z)if(a(z,C,P,h))z!==w&&n(z,w,h),++w;else if(!a(z,I,D,h))for(;;){if(a(x,I,D,h)){a(x,C,P,h)?(i(z,w,x,h),++w,--x):(n(z,x,h),--x);break}if(--x<z)break}o(e,w-1,C,P,h),o(c,x+1,I,D,h),w-2-e<=32?t(e,w-2,h):u(e,w-2,h),c-(x+2)<=32?t(x+2,c,h):u(x+2,c,h),x-w<=32?t(w,x,h):u(w,x,h)}e.exports=function(e,n){n<=128?t(0,n-1,e):u(0,n-1,e)}},2742:(e,t,n)=>{"use strict";e.exports={init:function(e){var t=i.nextPow2(e);u.length<t&&(r.free(u),u=r.mallocInt32(t)),c.length<t&&(r.free(c),c=r.mallocInt32(t)),h.length<t&&(r.free(h),h=r.mallocInt32(t)),l.length<t&&(r.free(l),l=r.mallocInt32(t)),f.length<t&&(r.free(f),f=r.mallocInt32(t)),d.length<t&&(r.free(d),d=r.mallocInt32(t));var n=8*t;p.length<n&&(r.free(p),p=r.mallocDouble(n))},sweepBipartite:function(e,t,n,r,i,a,f,d,g,y){for(var _=0,b=2*e,k=e-1,w=b-1,x=n;x<r;++x){var M=a[x],C=b*x;p[_++]=i[C+k],p[_++]=-(M+1),p[_++]=i[C+w],p[_++]=M}for(x=f;x<d;++x){M=y[x]+s;var P=b*x;p[_++]=g[P+k],p[_++]=-M,p[_++]=g[P+w],p[_++]=M}var I=_>>>1;o(p,I);var D=0,T=0;for(x=0;x<I;++x){var L=0|p[2*x+1];if(L>=s)v(h,l,T--,L=L-s|0);else if(L>=0)v(u,c,D--,L);else if(L<=-268435456){L=-L-s|0;for(var A=0;A<D;++A)if(void 0!==(E=t(u[A],L)))return E;m(h,l,T++,L)}else{for(L=-L-1|0,A=0;A<T;++A){var E;if(void 0!==(E=t(L,h[A])))return E}m(u,c,D++,L)}}},sweepComplete:function(e,t,n,r,i,s,a,g,y,_){for(var b=0,k=2*e,w=e-1,x=k-1,M=n;M<r;++M){var C=s[M]+1<<1,P=k*M;p[b++]=i[P+w],p[b++]=-C,p[b++]=i[P+x],p[b++]=C}for(M=a;M<g;++M){C=_[M]+1<<1;var I=k*M;p[b++]=y[I+w],p[b++]=1|-C,p[b++]=y[I+x],p[b++]=1|C}var D=b>>>1;o(p,D);var T=0,L=0,A=0;for(M=0;M<D;++M){var E=0|p[2*M+1],S=1&E;if(M<D-1&&E>>1==p[2*M+3]>>1&&(S=2,M+=1),E<0){for(var j=-(E>>1)-1,R=0;R<A;++R)if(void 0!==(O=t(f[R],j)))return O;if(0!==S)for(R=0;R<T;++R)if(void 0!==(O=t(u[R],j)))return O;if(1!==S)for(R=0;R<L;++R){var O;if(void 0!==(O=t(h[R],j)))return O}0===S?m(u,c,T++,j):1===S?m(h,l,L++,j):2===S&&m(f,d,A++,j)}else j=(E>>1)-1,0===S?v(u,c,T--,j):1===S?v(h,l,L--,j):2===S&&v(f,d,A--,j)}},scanBipartite:function(e,t,n,r,i,a,h,l,f,d,g,y){var _=0,b=2*e,k=t,w=t+e,x=1,M=1;r?M=s:x=s;for(var C=i;C<a;++C){var P=C+x,I=b*C;p[_++]=h[I+k],p[_++]=-P,p[_++]=h[I+w],p[_++]=P}for(C=f;C<d;++C){P=C+M;var D=b*C;p[_++]=g[D+k],p[_++]=-P}var T=_>>>1;o(p,T);var L=0;for(C=0;C<T;++C){var A=0|p[2*C+1];if(A<0){var E=!1;if((P=-A)>=s?(E=!r,P-=s):(E=!!r,P-=1),E)m(u,c,L++,P);else{var S=y[P],j=b*P,R=g[j+t+1],O=g[j+t+1+e];e:for(var F=0;F<L;++F){var B=u[F],z=b*B;if(!(O<h[z+t+1]||h[z+t+1+e]<R)){for(var U=t+2;U<e;++U)if(g[j+U+e]<h[z+U]||h[z+U+e]<g[j+U])continue e;var N,V=l[B];if(void 0!==(N=r?n(S,V):n(V,S)))return N}}}}else v(u,c,L--,A-x)}},scanComplete:function(e,t,n,r,i,a,c,h,l,f,d){for(var v=0,m=2*e,g=t,y=t+e,_=r;_<i;++_){var b=_+s,k=m*_;p[v++]=a[k+g],p[v++]=-b,p[v++]=a[k+y],p[v++]=b}for(_=h;_<l;++_){b=_+1;var w=m*_;p[v++]=f[w+g],p[v++]=-b}var x=v>>>1;o(p,x);var M=0;for(_=0;_<x;++_){var C=0|p[2*_+1];if(C<0)if((b=-C)>=s)u[M++]=b-s;else{var P=d[b-=1],I=m*b,D=f[I+t+1],T=f[I+t+1+e];e:for(var L=0;L<M;++L){var A=u[L],E=c[A];if(E===P)break;var S=m*A;if(!(T<a[S+t+1]||a[S+t+1+e]<D)){for(var j=t+2;j<e;++j)if(f[I+j+e]<a[S+j]||a[S+j+e]<f[I+j])continue e;var R=n(E,P);if(void 0!==R)return R}}}else{for(b=C-s,L=M-1;L>=0;--L)if(u[L]===b){for(j=L+1;j<M;++j)u[j-1]=u[j];break}--M}}}};var r=n(8072),i=n(1205),o=n(1120),s=1<<28,a=1024,u=r.mallocInt32(a),c=r.mallocInt32(a),h=r.mallocInt32(a),l=r.mallocInt32(a),f=r.mallocInt32(a),d=r.mallocInt32(a),p=r.mallocDouble(8192);function v(e,t,n,r){var i=t[r],o=e[n-1];e[i]=o,t[o]=i}function m(e,t,n,r){e[n]=r,t[r]=n}},2820:e=>{"use strict";function t(e,n,r){var i=0|e[r];if(i<=0)return[];var o,s=new Array(i);if(r===e.length-1)for(o=0;o<i;++o)s[o]=n;else for(o=0;o<i;++o)s[o]=t(e,n,r+1);return s}e.exports=function(e,n){switch(void 0===n&&(n=0),typeof e){case"number":if(e>0)return function(e,t){var n,r;for(n=new Array(e),r=0;r<e;++r)n[r]=t;return n}(0|e,n);break;case"object":if("number"==typeof e.length)return t(e,n,0)}return[]}},1628:(e,t,n)=>{e.exports=function(){var e=this;this.components={},this.comps=this.components;var t=this.components,n=1,i={},o=[],s=[],a={timeout:!1,removals:[],multiComps:[]};function u(e,n){var r=t[n],o=i[n],s=o.hash[e];s&&(o.remove(e),r.onRemove&&(r.multi?(s.forEach((t=>{t&&r.onRemove(e,t)})),s.length=0):r.onRemove(e,s)),a.removals.push(o),c())}function c(){a.timeout||(a.timeout=!0,setTimeout(h,1))}function h(){a.timeout=!1,l()}function l(){a.multiComps.length&&function(e){for(var t=0;t<e.length;t++){var{entID:n,data:r}=e[t],i=r.hash[n];if(i){for(var o=0;o<i.length;o++)i[o]||(i.splice(o,1),o--);0===i.length&&(r.remove(n),a.removals.push(r))}}e.length=0}(a.multiComps),a.removals.length&&function(e){for(var t=0;t<e.length;t++)e[t].flush();e.length=0}(a.removals)}this._storage=i,this._systems=o,this._renderSystems=s,this.createEntity=function(t){var r=n++;return Array.isArray(t)&&t.forEach((t=>e.addComponent(r,t))),r},this.deleteEntity=function(t){return Object.keys(i).forEach((e=>{i[e].hash[t]&&u(t,e)})),e},this.createComponent=function(e){if(!e)throw"Missing component definition";var n=e.name;if(!n)throw"Component definition must have a name property.";if("string"!=typeof n)throw"Component name must be a string.";if(""===n)throw"Component name must be a non-empty string.";if(i[n])throw`Component ${n} already exists.`;var a={};return a.name=n,a.multi=!!e.multi,a.order=isNaN(e.order)?99:e.order,a.state=e.state||{},a.onAdd=e.onAdd||null,a.onRemove=e.onRemove||null,a.system=e.system||null,a.renderSystem=e.renderSystem||null,t[n]=a,i[n]=new r,i[n]._pendingMultiCleanup=!1,i[n]._multiCleanupIDs=a.multi?[]:null,a.system&&(o.push(n),o.sort(((e,n)=>t[e].order-t[n].order))),a.renderSystem&&(s.push(n),s.sort(((e,n)=>t[e].order-t[n].order))),n},this.deleteComponent=function(n){var r=i[n];if(!r)throw`Unknown component: ${n}`;r.flush(),r.list.forEach((e=>{e&&u(e.__id||e[0].__id,n)}));var a=o.indexOf(n),c=s.indexOf(n);return a>-1&&o.splice(a,1),c>-1&&s.splice(c,1),i[n].dispose(),delete i[n],delete t[n],e},this.addComponent=function(e,n,r){var o=t[n],s=i[n];if(!s)throw`Unknown component: ${n}.`;if(s.hash[e]&&!o.multi)throw`Entity ${e} already has component: ${n}.`;var a=Object.assign({},{__id:e},o.state,r);if(a.__id=e,o.multi){var u=s.hash[e];u||(u=[],s.add(e,u)),u.push(a)}else s.add(e,a);return o.onAdd&&o.onAdd(e,a),this},this.hasComponent=function(e,t){var n=i[t];if(!n)throw`Unknown component: ${t}.`;return!!n.hash[e]},this.removeComponent=function(t,n){if(!i[n])throw`Unknown component: ${n}.`;return u(t,n),e},this.getState=function(e,t){var n=i[t];if(!n)throw`Unknown component: ${t}.`;return n.hash[e]},this.getStatesList=function(e){var t=i[e];if(!t)throw`Unknown component: ${e}.`;return l(),t.list},this.getStateAccessor=function(e){if(!i[e])throw`Unknown component: ${e}.`;var t=i[e].hash;return e=>t[e]},this.getComponentAccessor=function(e){if(!i[e])throw`Unknown component: ${e}.`;var t=i[e].hash;return e=>!!t[e]},this.tick=function(n){l();for(var r=0;r<o.length;r++){var s=o[r],a=t[s],u=i[s];a.system(n,u.list),l()}return e},this.render=function(n){l();for(var r=0;r<s.length;r++){var o=s[r],a=t[o],u=i[o];a.renderSystem(n,u.list),l()}return e},this.removeMultiComponent=function(n,r,o){var s=t[r],u=i[r];if(!u)throw`Unknown component: ${r}.`;if(!s.multi)throw"removeMultiComponent called on non-multi component";return function(e,t,n,r){var i=n.hash[e];if(i){var o=i[r];o&&(i[r]=null,t.onRemove&&t.onRemove(e,o),a.multiComps.push({entID:e,data:n}),c())}}(n,s,u,o),e}};var r=n(6088)},6088:e=>{function t(e,t){var n=e._map[t];if(delete e.hash[t],delete e._map[t],n===e.list.length-1)e.list.pop();else{var r=e.list.pop();if(e.list[n]=r,null===r||null===r[0]){var i=e.list.length;for(var o in e._map)if(e._map[o]===i)return void(e._map[o]=n)}else{var s=r.__id||r[0].__id;e._map[s]=n}}}e.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(e,t){if("number"==typeof this._map[e]){var n=this._map[e];this.hash[e]=t,this.list[n]=t}else this._map[e]=this.list.length,this.hash[e]=t,this.list.push(t)}remove(e){var t=this._map[e];this.hash[e]=null,this.list[t]=null,this._pendingRemovals.push(e)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var e=0;e<this._pendingRemovals.length;e++){var n=this._pendingRemovals[e];null===this.hash[n]&&t(this,n)}this._pendingRemovals.length=0}}},133:e=>{"use strict";var t,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}v(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&v(e,"error",t,{once:!0})}(e,i)}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function c(e,t,n,r){var i,o,s,c;if(a(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),void 0===s)s=o[t]=n,++e._eventsCount;else if("function"==typeof s?s=o[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(i=u(e))>0&&s.length>i&&!s.warned){s.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=e,h.type=t,h.count=s.length,c=h,console&&console.warn&&console.warn(c)}return e}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=h.bind(r);return i.listener=n,r.wrapFn=i,i}function f(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):p(i,i.length)}function d(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function v(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return u(this)},o.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var u=o[e];if(void 0===u)return!1;if("function"==typeof u)r(u,this,t);else{var c=u.length,h=p(u,c);for(n=0;n<c;++n)r(h[n],this,t)}return!0},o.prototype.addListener=function(e,t){return c(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return c(this,e,t,!0)},o.prototype.once=function(e,t){return a(t),this.on(e,l(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,l(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,r,i,o,s;if(a(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return f(this,e,!0)},o.prototype.rawListeners=function(e){return f(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):d.call(e,t)},o.prototype.listenerCount=d,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},6496:e=>{"use strict";e.exports=function(e,t,n,r,i,o){var s=+t[0],a=+t[1],u=+t[2],c=+n[0],h=+n[1],l=+n[2],f=Math.sqrt(c*c+h*h+l*l);if(0===f)throw new Error("Can't raycast along a zero vector");return function(e,t,n,r,i,o,s,a,u,c){for(var h=0,l=Math.floor,f=0|l(t),d=0|l(n),p=0|l(r),v=i>0?1:-1,m=o>0?1:-1,g=s>0?1:-1,y=Math.abs(1/i),_=Math.abs(1/o),b=Math.abs(1/s),k=y<1/0?y*(v>0?f+1-t:t-f):1/0,w=_<1/0?_*(m>0?d+1-n:n-d):1/0,x=b<1/0?b*(g>0?p+1-r:r-p):1/0,M=-1;h<=a;){var C=e(f,d,p);if(C)return u&&(u[0]=t+h*i,u[1]=n+h*o,u[2]=r+h*s),c&&(c[0]=c[1]=c[2]=0,0===M&&(c[0]=-v),1===M&&(c[1]=-m),2===M&&(c[2]=-g)),C;k<w?k<x?(f+=v,h=k,k+=y,M=0):(p+=g,h=x,x+=b,M=2):w<x?(d+=m,h=w,w+=_,M=1):(p+=g,h=x,x+=b,M=2)}return u&&(u[0]=t+h*i,u[1]=n+h*o,u[2]=r+h*s),c&&(c[0]=c[1]=c[2]=0),0}(e,s,a,u,c/=f,h/=f,l/=f,r=void 0===r?64:+r,i,o)}},1712:e=>{e.exports=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}},5533:(e,t,n)=>{e.exports=function(e,t){var n=r(e[0],e[1],e[2]),s=r(t[0],t[1],t[2]);i(n,n),i(s,s);var a=o(n,s);return a>1?0:Math.acos(a)};var r=n(130),i=n(6532),o=n(549)},5453:e=>{e.exports=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}},7130:e=>{e.exports=function(e){var t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}},1943:e=>{e.exports=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}},3780:e=>{e.exports=function(){var e=new Float32Array(3);return e[0]=0,e[1]=0,e[2]=0,e}},1918:e=>{e.exports=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=n[0],a=n[1],u=n[2];return e[0]=i*u-o*a,e[1]=o*s-r*u,e[2]=r*a-i*s,e}},5083:(e,t,n)=>{e.exports=n(2871)},2871:e=>{e.exports=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)}},8776:(e,t,n)=>{e.exports=n(7925)},7925:e=>{e.exports=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}},549:e=>{e.exports=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}},2222:e=>{e.exports=1e-6},9885:(e,t,n)=>{e.exports=function(e,t){var n=e[0],i=e[1],o=e[2],s=t[0],a=t[1],u=t[2];return Math.abs(n-s)<=r*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-a)<=r*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(o-u)<=r*Math.max(1,Math.abs(o),Math.abs(u))};var r=n(2222)},4945:e=>{e.exports=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}},535:e=>{e.exports=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}},5264:(e,t,n)=>{e.exports=function(e,t,n,i,o,s){var a,u;for(t||(t=3),n||(n=0),u=i?Math.min(i*t+n,e.length):e.length,a=n;a<u;a+=t)r[0]=e[a],r[1]=e[a+1],r[2]=e[a+2],o(r,r,s),e[a]=r[0],e[a+1]=r[1],e[a+2]=r[2];return e};var r=n(3780)()},130:e=>{e.exports=function(e,t,n){var r=new Float32Array(3);return r[0]=e,r[1]=t,r[2]=n,r}},8010:(e,t,n)=>{e.exports={EPSILON:n(2222),create:n(3780),clone:n(7130),angle:n(5533),fromValues:n(130),copy:n(1943),set:n(7070),equals:n(9885),exactEquals:n(4945),add:n(1712),subtract:n(3555),sub:n(4174),multiply:n(2010),mul:n(1667),divide:n(7925),div:n(8776),min:n(2514),max:n(1558),floor:n(535),ceil:n(5453),round:n(281),scale:n(709),scaleAndAdd:n(4402),distance:n(2871),dist:n(5083),squaredDistance:n(2611),sqrDist:n(2365),length:n(9062),len:n(8785),squaredLength:n(2053),sqrLen:n(7667),negate:n(777),inverse:n(3504),normalize:n(6532),dot:n(549),cross:n(1918),lerp:n(5713),random:n(4870),transformMat4:n(3798),transformMat3:n(4803),transformQuat:n(6755),rotateX:n(2405),rotateY:n(5931),rotateZ:n(6763),forEach:n(5264)}},3504:e=>{e.exports=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}},8785:(e,t,n)=>{e.exports=n(9062)},9062:e=>{e.exports=function(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)}},5713:e=>{e.exports=function(e,t,n,r){var i=t[0],o=t[1],s=t[2];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=s+r*(n[2]-s),e}},1558:e=>{e.exports=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}},2514:e=>{e.exports=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}},1667:(e,t,n)=>{e.exports=n(2010)},2010:e=>{e.exports=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}},777:e=>{e.exports=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}},6532:e=>{e.exports=function(e,t){var n=t[0],r=t[1],i=t[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o),e}},4870:e=>{e.exports=function(e,t){t=t||1;var n=2*Math.random()*Math.PI,r=2*Math.random()-1,i=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*i,e[1]=Math.sin(n)*i,e[2]=r*t,e}},2405:e=>{e.exports=function(e,t,n,r){var i=n[1],o=n[2],s=t[1]-i,a=t[2]-o,u=Math.sin(r),c=Math.cos(r);return e[0]=t[0],e[1]=i+s*c-a*u,e[2]=o+s*u+a*c,e}},5931:e=>{e.exports=function(e,t,n,r){var i=n[0],o=n[2],s=t[0]-i,a=t[2]-o,u=Math.sin(r),c=Math.cos(r);return e[0]=i+a*u+s*c,e[1]=t[1],e[2]=o+a*c-s*u,e}},6763:e=>{e.exports=function(e,t,n,r){var i=n[0],o=n[1],s=t[0]-i,a=t[1]-o,u=Math.sin(r),c=Math.cos(r);return e[0]=i+s*c-a*u,e[1]=o+s*u+a*c,e[2]=t[2],e}},281:e=>{e.exports=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}},709:e=>{e.exports=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}},4402:e=>{e.exports=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}},7070:e=>{e.exports=function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}},2365:(e,t,n)=>{e.exports=n(2611)},7667:(e,t,n)=>{e.exports=n(2053)},2611:e=>{e.exports=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}},2053:e=>{e.exports=function(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}},4174:(e,t,n)=>{e.exports=n(3555)},3555:e=>{e.exports=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}},4803:e=>{e.exports=function(e,t,n){var r=t[0],i=t[1],o=t[2];return e[0]=r*n[0]+i*n[3]+o*n[6],e[1]=r*n[1]+i*n[4]+o*n[7],e[2]=r*n[2]+i*n[5]+o*n[8],e}},3798:e=>{e.exports=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=n[3]*r+n[7]*i+n[11]*o+n[15];return s=s||1,e[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/s,e[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/s,e[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/s,e}},6755:e=>{e.exports=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=n[0],a=n[1],u=n[2],c=n[3],h=c*r+a*o-u*i,l=c*i+u*r-s*o,f=c*o+s*i-a*r,d=-s*r-a*i-u*o;return e[0]=h*c+d*-s+l*-u-f*-a,e[1]=l*c+d*-a+f*-s-h*-u,e[2]=f*c+d*-u+h*-a-l*-s,e}},65:e=>{"use strict";e.exports=function(e){for(var t=new Array(e),n=0;n<e;++n)t[n]=n;return t}},712:e=>{e.exports=function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}},1920:(e,t,n)=>{var r=n(65),i=n(5303),o="undefined"!=typeof Float64Array;function s(e,t){return e[0]-t[0]}function a(){var e,t=this.stride,n=new Array(t.length);for(e=0;e<n.length;++e)n[e]=[Math.abs(t[e]),e];n.sort(s);var r=new Array(n.length);for(e=0;e<r.length;++e)r[e]=n[e][1];return r}function u(e,t){var n=["View",t,"d",e].join("");t<0&&(n="View_Nil"+e);var i="generic"===e;if(-1===t){var o="function "+n+"(a){this.data=a;};var proto="+n+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+n+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+n+"(a){return new "+n+"(a);}";return new Function(o)()}if(0===t)return o="function "+n+"(a,d) {this.data = a;this.offset = d};var proto="+n+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+n+"_copy() {return new "+n+"(this.data,this.offset)};proto.pick=function "+n+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+n+"_get(){return "+(i?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+n+"_set(v){return "+(i?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+n+"(a,b,c,d){return new "+n+"(a,d)}",new Function("TrivialArray",o)(c[e][0]);o=["'use strict'"];var s=r(t),u=s.map((function(e){return"i"+e})),h="this.offset+"+s.map((function(e){return"this.stride["+e+"]*i"+e})).join("+"),l=s.map((function(e){return"b"+e})).join(","),f=s.map((function(e){return"c"+e})).join(",");o.push("function "+n+"(a,"+l+","+f+",d){this.data=a","this.shape=["+l+"]","this.stride=["+f+"]","this.offset=d|0}","var proto="+n+".prototype","proto.dtype='"+e+"'","proto.dimension="+t),o.push("Object.defineProperty(proto,'size',{get:function "+n+"_size(){return "+s.map((function(e){return"this.shape["+e+"]"})).join("*"),"}})"),1===t?o.push("proto.order=[0]"):(o.push("Object.defineProperty(proto,'order',{get:"),t<4?(o.push("function "+n+"_order(){"),2===t?o.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&o.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):o.push("ORDER})")),o.push("proto.set=function "+n+"_set("+u.join(",")+",v){"),i?o.push("return this.data.set("+h+",v)}"):o.push("return this.data["+h+"]=v}"),o.push("proto.get=function "+n+"_get("+u.join(",")+"){"),i?o.push("return this.data.get("+h+")}"):o.push("return this.data["+h+"]}"),o.push("proto.index=function "+n+"_index(",u.join(),"){return "+h+"}"),o.push("proto.hi=function "+n+"_hi("+u.join(",")+"){return new "+n+"(this.data,"+s.map((function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")})).join(",")+","+s.map((function(e){return"this.stride["+e+"]"})).join(",")+",this.offset)}");var d=s.map((function(e){return"a"+e+"=this.shape["+e+"]"})),p=s.map((function(e){return"c"+e+"=this.stride["+e+"]"}));o.push("proto.lo=function "+n+"_lo("+u.join(",")+"){var b=this.offset,d=0,"+d.join(",")+","+p.join(","));for(var v=0;v<t;++v)o.push("if(typeof i"+v+"==='number'&&i"+v+">=0){d=i"+v+"|0;b+=c"+v+"*d;a"+v+"-=d}");for(o.push("return new "+n+"(this.data,"+s.map((function(e){return"a"+e})).join(",")+","+s.map((function(e){return"c"+e})).join(",")+",b)}"),o.push("proto.step=function "+n+"_step("+u.join(",")+"){var "+s.map((function(e){return"a"+e+"=this.shape["+e+"]"})).join(",")+","+s.map((function(e){return"b"+e+"=this.stride["+e+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil"),v=0;v<t;++v)o.push("if(typeof i"+v+"==='number'){d=i"+v+"|0;if(d<0){c+=b"+v+"*(a"+v+"-1);a"+v+"=ceil(-a"+v+"/d)}else{a"+v+"=ceil(a"+v+"/d)}b"+v+"*=d}");o.push("return new "+n+"(this.data,"+s.map((function(e){return"a"+e})).join(",")+","+s.map((function(e){return"b"+e})).join(",")+",c)}");var m=new Array(t),g=new Array(t);for(v=0;v<t;++v)m[v]="a[i"+v+"]",g[v]="b[i"+v+"]";for(o.push("proto.transpose=function "+n+"_transpose("+u+"){"+u.map((function(e,t){return e+"=("+e+"===undefined?"+t+":"+e+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+n+"(this.data,"+m.join(",")+","+g.join(",")+",this.offset)}"),o.push("proto.pick=function "+n+"_pick("+u+"){var a=[],b=[],c=this.offset"),v=0;v<t;++v)o.push("if(typeof i"+v+"==='number'&&i"+v+">=0){c=(c+this.stride["+v+"]*i"+v+")|0}else{a.push(this.shape["+v+"]);b.push(this.stride["+v+"])}");return o.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),o.push("return function construct_"+n+"(data,shape,stride,offset){return new "+n+"(data,"+s.map((function(e){return"shape["+e+"]"})).join(",")+","+s.map((function(e){return"stride["+e+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",o.join("\n"))(c[e],a)}var c={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};e.exports=function(e,t,n,r){if(void 0===e)return(0,c.array[0])([]);"number"==typeof e&&(e=[e]),void 0===t&&(t=[e.length]);var s=t.length;if(void 0===n){n=new Array(s);for(var a=s-1,h=1;a>=0;--a)n[a]=h,h*=t[a]}if(void 0===r)for(r=0,a=0;a<s;++a)n[a]<0&&(r-=(t[a]-1)*n[a]);for(var l=function(e){if(i(e))return"buffer";if(o)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(e)?"array":"generic"}(e),f=c[l];f.length<=s+1;)f.push(u(l,f.length-1));return(0,f[s+1])(e,t,n,r)}},5303:e=>{function t(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(t(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&t(e.slice(0,0))}(e)||!!e._isBuffer)}},7504:e=>{"use strict";var t=[],n=[],r=[],i=[],o=[],s=[],a=[],u=[],c=[],h=[],l=[],f=[];e.exports=function(e,d,p,v,m,g){for(var y=a,_=c,b=h,k=f,w=0;w<3;w++)y[w]=+p[w],b[w]=+d.max[w],_[w]=+d.base[w];g||(g=1e-10);var x=function(e,a,c,h,f,d){var p=t,v=n,m=r,g=i,y=o,_=s,b=u,k=Math.floor,w=0,x=0,M=0,C=0,P=0;if(I(),0===M)return 0;for(C=L();x<=M;){if(D(C)&&T())return w;C=L()}for(w+=M,P=0;P<3;P++)h[P]+=c[P],f[P]+=c[P];return w;function I(){if(x=0,0!==(M=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2])))for(var e=0;e<3;e++){var t=c[e]>=0;g[e]=t?1:-1;var n=t?f[e]:h[e];p[e]=t?h[e]:f[e],v[e]=A(n,g[e]),m[e]=E(p[e],g[e]),b[e]=c[e]/M,y[e]=Math.abs(1/b[e]);var r=t?v[e]+1-n:n-v[e];_[e]=y[e]<1/0?y[e]*r:1/0}}function D(t){for(var n=g[0],r=0===t?v[0]:m[0],i=v[0]+n,o=g[1],s=1===t?v[1]:m[1],a=v[1]+o,u=g[2],c=2===t?v[2]:m[2],h=v[2]+u,l=r;l!=i;l+=n)for(var f=s;f!=a;f+=o)for(var d=c;d!=h;d+=u)if(e(l,f,d))return!0;return!1}function T(){w+=x;var e=g[C],t=x/M,n=l;for(P=0;P<3;P++){var r=c[P]*t;h[P]+=r,f[P]+=r,n[P]=c[P]-r}if(e>0?f[C]=Math.round(f[C]):h[C]=Math.round(h[C]),a(w,C,e,n))return!0;for(P=0;P<3;P++)c[P]=n[P];return I(),0===M}function L(){var e=_[0]<_[1]?_[0]<_[2]?0:2:_[1]<_[2]?1:2,t=_[e]-x;for(x=_[e],v[e]+=g[e],_[e]+=y[e],P=0;P<3;P++)p[P]+=t*b[P],m[P]=E(p[P],g[P]);return e}function A(e,t){return k(e-t*d)}function E(e,t){return k(e+t*d)}}(e,v,y,_,b,g);if(!m){for(w=0;w<3;w++)k[w]=p[w]>0?b[w]-d.max[w]:_[w]-d.base[w];d.translate(k)}return x}},202:(e,t,n)=>{"use strict";function r(e,t){var n=e.indexOf(t);n<0||(n===e.length-1?e.pop():e[n]=e.pop())}function i(e,t,n){var r=n||performance.now();if(!t()){var i=performance.now(),o=r+e-(i-n)/2;if(!(i>o))for(var s=0;s<1e3;s++)if(t()||performance.now()>o)return}}function o(e,t,n,r,i){"number"==typeof e?function(e,t,n,r,i,o,s,a){for(var u=t.stride[2],c=0;c<o;c++)for(var h=0;h<s;h++)for(var l=t.index(n+c,r+h,i),f=0;f<a;f++)t.data[l]=e,l+=u}(e,t,i[0],i[1],i[2],r[0],r[1],r[2]):function(e,t,n,r,i,o,s,a,u,c,h){for(var l=e.stride[2],f=t.stride[2],d=0;d<o;d++)for(var p=0;p<s;p++)for(var v=e.index(n+d,r+p,i),m=t.index(u+d,c+p,h),g=0;g<a;g++)t.data[m]=e.data[v],v+=l,m+=f}(e,t,n[0],n[1],n[2],r[0],r[1],r[2],i[0],i[1],i[2])}function s(e,t,n){return 1023&e|(1023&t)<<10|(1023&n)<<20}function a(){var e={};this.getChunkByIndexes=(t,n,r)=>e[s(t,n,r)]||null,this.storeChunkByIndexes=(t,n,r,i)=>{e[s(t,n,r)]=i},this.removeChunkByIndexes=(t,n,r)=>{delete e[s(t,n,r)]}}function u(){this.arr=[],this.hash={}}function c(e,t,n){if(!(e>0))return()=>{};t=t||"";var r=[],i=[],o=0,s=0,a=0,u=0,c=!0;return function(h){"start"===h?(c&&(r.length=i.length=0,c=!1),o=s=performance.now(),a++):"end"===h?function(){if(u+=performance.now()-o,a===e){var s=t+" total "+(u/e).toFixed(2)+"ms (avg, "+e+" runs)    ";console.log(s,i.map((function(t,i){return n&&r[i]/u<.05?"":t+": "+(r[i]/e).toFixed(2)+"ms    "})).join("")),c=!0,a=0,u=0}}():function(e){var t=performance.now();i.indexOf(e)<0&&i.push(e);var n=i.indexOf(e);r[n]||(r[n]=0),r[n]+=t-s,s=t}(h)}}n.d(t,{xP:()=>r,KV:()=>i,Fx:()=>o,wX:()=>s,dM:()=>a,l3:()=>u,hv:()=>c}),u.prototype.forEach=function(e,t){this.arr.forEach(e,t)},u.prototype.includes=function(e,t,n){var r=s(e,t,n);return!!this.hash[r]},u.prototype.add=function(e,t,n){var r=s(e,t,n);this.hash[r]||(this.arr.push([e,t,n,r]),this.hash[r]=!0)},u.prototype.addToFront=function(e,t,n){var r=s(e,t,n);this.hash[r]||(this.arr.unshift([e,t,n,r]),this.hash[r]=!0)},u.prototype.removeByIndex=function(e){var t=this.arr[e];delete this.hash[t[3]],this.arr.splice(e,1)},u.prototype.remove=function(e,t,n){var r=s(e,t,n);if(this.hash[r]){delete this.hash[r];for(var i=0;i<this.arr.length;i++)if(r===this.arr[i][3])return void this.arr.splice(i,1);throw"internal bug with location queue - hash value overlapped"}},u.prototype.count=function(){return this.arr.length},u.prototype.isEmpty=function(){return 0===this.arr.length},u.prototype.empty=function(){this.arr.length=0,this.hash={}},u.prototype.pop=function(){var e=this.arr.pop();return delete this.hash[e[3]],e},u.prototype.copyFrom=function(e){for(var t in this.arr=e.arr.slice(),this.hash={},e.hash)this.hash[t]=!0},u.prototype.sortByDistance=function(e){var t={};for(var n of this.arr)t[n]=e(n[0],n[1],n[2]);this.arr.sort(((e,n)=>t[n]-t[e])),t=null}},9257:e=>{"use strict";var t,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}v(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&v(e,"error",t,{once:!0})}(e,i)}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function c(e,t,n,r){var i,o,s,c;if(a(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),void 0===s)s=o[t]=n,++e._eventsCount;else if("function"==typeof s?s=o[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(i=u(e))>0&&s.length>i&&!s.warned){s.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=e,h.type=t,h.count=s.length,c=h,console&&console.warn&&console.warn(c)}return e}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=h.bind(r);return i.listener=n,r.wrapFn=i,i}function f(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):p(i,i.length)}function d(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function v(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return u(this)},o.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var u=o[e];if(void 0===u)return!1;if("function"==typeof u)r(u,this,t);else{var c=u.length,h=p(u,c);for(n=0;n<c;++n)r(h[n],this,t)}return!0},o.prototype.addListener=function(e,t){return c(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return c(this,e,t,!0)},o.prototype.once=function(e,t){return a(t),this.on(e,l(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,l(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,r,i,o,s;if(a(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return f(this,e,!0)},o.prototype.rawListeners=function(e){return f(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):d.call(e,t)},o.prototype.listenerCount=d,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}}},n={};function r(e){var i=n[e];if(void 0!==i)return i.exports;var o=n[e]={exports:{}};return t[e](o,o.exports,r),o.exports}r.m=t,e=[],r.O=(t,n,i,o)=>{if(!n){var s=1/0;for(h=0;h<e.length;h++){for(var[n,i,o]=e[h],a=!0,u=0;u<n.length;u++)(!1&o||s>=o)&&Object.keys(r.O).every((e=>r.O[e](n[u])))?n.splice(u--,1):(a=!1,o<s&&(s=o));if(a){e.splice(h--,1);var c=i();void 0!==c&&(t=c)}}return t}o=o||0;for(var h=e.length;h>0&&e[h-1][2]>o;h--)e[h]=e[h-1];e[h]=[n,i,o]},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};r.O.j=t=>0===e[t];var t=(t,n)=>{var i,o,[s,a,u]=n,c=0;if(s.some((t=>0!==e[t]))){for(i in a)r.o(a,i)&&(r.m[i]=a[i]);if(u)var h=u(r)}for(t&&t(n);c<s.length;c++)o=s[c],r.o(e,o)&&e[o]&&e[o][0](),e[s[c]]=0;return r.O(h)},n=self.webpackChunk=self.webpackChunk||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var i=r.O(void 0,[479],(()=>r(2618)));i=r.O(i)})();
//# sourceMappingURL=bundle.js.map